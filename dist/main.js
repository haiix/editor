(()=>{"use strict";var e,t,n,i,r,s={1268:(e,t,n)=>{function i(e=null,t=null){if(t=t||document.body,!e)return t;if(e.firstElementChild)return e.firstElementChild;for(;e!==t;){if(e.nextElementSibling)return e.nextElementSibling;e=e.parentElement}return null}function r(e=null,t=null){if(e===(t=t||document.body))return null;if(e){if(!e.previousElementSibling)return e.parentElement;e=e.previousElementSibling}else e=t;for(;e.lastElementChild;)e=e.lastElementChild;return e}function s(e){if(!(e instanceof window.HTMLElement))return!1;const t=e.getAttribute("tabIndex");return null==t?"A"===e.tagName?!!e.href:["BUTTON","INPUT","SELECT","TEXTAREA"].includes(e.tagName)&&!e.disabled:t-0>=0}function o(e=null,t=null){let n=1;if(null!=e){const r=Math.max(0,e.tabIndex);for(;e=i(e,t);)if(s(e)&&e.tabIndex===r)return e;if(0===r)return null;e=null,n=r+1}let r=Number.POSITIVE_INFINITY,o=null;for(;e=i(e,t);){if(!s(e))continue;const t=e.tabIndex||Number.MAX_SAFE_INTEGER;t>=n&&r>t&&(r=t,o=e)}return o}function a(e=null,t=null){let n=Number.POSITIVE_INFINITY;if(null!=e){const i=Math.max(0,e.tabIndex);for(;e=r(e,t);)if(s(e)&&e.tabIndex===i)return e;if(1===i)return null;e=null,n=0===i?Number.MAX_SAFE_INTEGER:i-1}let i=-1,o=null;for(;e=r(e,t);){if(!s(e))continue;const t=e.tabIndex||Number.POSITIVE_INFINITY;t<=n&&i<t&&(i=t,o=e)}return o}n.d(t,{CD:()=>a,Wq:()=>s,rO:()=>o})},4857:(e,t,n)=>{n.d(t,{Un:()=>o,ZP:()=>a,dR:()=>s});let i=!1;const r=[];function s(){i=!0}function o(){if(i=!1,0===r.length)return;const e=document.createElement("style");e.textContent=r.join("\n"),document.head.appendChild(e),r.length=0}function a(...e){r.push(...e),i||o()}},5745:(e,t,n)=>{n.d(t,{NL:()=>d,Z9:()=>l,ZB:()=>u,ZP:()=>a,eB:()=>h,iG:()=>c});var i=n(4502),r=n(4857),s=n(1268);const o="t-component-ui-dialog";(0,r.ZP)(`\n  .${o} {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    outline: none;\n  }\n  .${o}-background {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: -1;\n  }\n  .${o}-container {\n    background: #FFF;\n    border: 1px solid #999;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.25);\n    display: flex;\n    flex-flow: column nowrap;\n    color: #000;\n    background: #FFF;\n  }\n  .${o}-title {\n    flex: none;\n    padding: 4px;\n    color: #000;\n    background: #EEE;\n  }\n  .${o}-body {\n    flex: auto;\n  }\n  .${o}-buttons {\n    flex: none;\n    display: flex;\n    justify-content: flex-end;\n    padding: 0 5px;\n  }\n  .${o}-buttons > button {\n    width: 75px;\n    margin: 5px;\n    white-space: nowrap;\n  }\n`);class a extends i.ZP{static create(e){return async function(...t){await new Promise((e=>window.requestAnimationFrame(e)));const n=document.activeElement;let r,o=null;const a=await new Promise((n=>{r=new e(Object.assign({resolve:n},{arguments:t})),document.body.appendChild(r.element);const a=(0,s.rO)(null,r.element);if(a){const e=(0,s.CD)(null,r.element);o=i.ZP.createElement('<div style="position: absolute; overflow: hidden; width: 0;"><input onfocus="this.handleFocus(event)" tabindex="1" /></div>',{handleFocus(e){a.focus()}}),document.body.insertBefore(o,document.body.firstChild),r.element.addEventListener("keydown",(t=>{if(9===t.keyCode&&!1===t.ctrlKey&&!1===t.altKey){const n=(0,s.Wq)(t.target);!t.shiftKey||n&&t.target!==a?t.shiftKey||n&&t.target!==e||(t.preventDefault(),a.focus()):(t.preventDefault(),e.focus())}})),a.focus(),a instanceof window.HTMLInputElement&&a.select()}r.main&&r.main()}));return document.body.removeChild(r.element),o&&document.body.removeChild(o),n.focus(),await new Promise((e=>window.requestAnimationFrame(e))),a}}template(){return this.tagName="t-dialog",`\n      <div class="${o}" onkeydown="this.handleKeyDown(event)" tabindex="-1">\n        <div class="${o}-background"></div>\n        <div class="${o}-container">\n          <div id="title" class="${o}-title">${this.titleTemplate()}</div>\n          <div id="body" class="${o}-body">${this.bodyTemplate()}</div>\n          <div id="buttons" class="${o}-buttons">${this.buttonsTemplate()}</div>\n        </div>\n      </div>\n    `}titleTemplate(){return""}bodyTemplate(){return""}buttonsTemplate(){return""}constructor(e={},t=[]){super(e,t),this.resolve=e.resolve}handleOK(e){this.resolve(null)}handleCancel(e){this.resolve(null)}handleKeyDown(e){e.stopPropagation();let t=document.activeElement;switch(e.keyCode){case 13:"BUTTON"!==e.target.tagName&&"function"==typeof this.handleOK&&this.handleOK(e);break;case 27:"function"==typeof this.handleCancel&&this.handleCancel(e);break;case 37:case 38:"BUTTON"===t.tagName&&this.buttons.contains(t)&&(t=(0,s.CD)(t,this.buttons),t||(t=(0,s.CD)(t,this.buttons)),t&&t.focus());break;case 39:case 40:"BUTTON"===t.tagName&&this.buttons.contains(t)&&(t=(0,s.rO)(t,this.buttons),t||(t=(0,s.rO)(t,this.buttons)),t&&t.focus())}}}const l=a.create(class extends a{bodyTemplate(){return'\n      <p id="text" style="white-space: pre-wrap; padding: 10px;"></p>\n    '}buttonsTemplate(){return'\n      <button id="okButton" onclick="return this.handleOK(event)">OK</button>\n    '}constructor(e={},t=[]){super(e,t);const[n="",i="情報"]=e.arguments;this.title.textContent=i,this.text.textContent=n}}),c=a.create(class extends a{bodyTemplate(){return'\n      <p id="text" style="white-space: pre-wrap; padding: 10px;"></p>\n    '}buttonsTemplate(){return'\n      <button id="okButton" onclick="return this.handleOK(event)">はい</button>\n      <button onclick="return this.handleCancel(event)">いいえ</button>\n    '}constructor(e={},t=[]){super(e,t);const[n="",i="確認"]=e.arguments;this.title.textContent=i,this.text.textContent=n}handleOK(e){this.resolve(!0)}handleCancel(e){this.resolve(!1)}});class d extends a{bodyTemplate(){return'\n      <form onsubmit="event.preventDefault()">\n        <p id="text" style="white-space: pre-wrap; padding: 10px;"></p>\n        <input id="input" />\n      </form>\n    '}buttonsTemplate(){return'\n      <button onclick="return this.handleOK(event)">OK</button>\n      <button onclick="return this.handleCancel(event)">キャンセル</button>\n    '}constructor(e={},t=[]){super(e,t);const[n="",i="",r="入力"]=e.arguments;this.title.textContent=r,this.text.textContent=n,this.input.value=i}handleOK(e){this.resolve(this.input.value)}}const h=a.create(d);async function u(e="",t=!1){return await new Promise((n=>{const r=i.ZP.createElement(`<input type="file" accept="${e}" ${t?"multiple":""} hidden />`);r.onchange=e=>{n(t?r.files:r.files[0])},window.addEventListener("focus",(function e(t){window.removeEventListener("focus",e),setTimeout(n,1e3,null)})),document.body.appendChild(r),r.click(),document.body.removeChild(r)}))}},4502:(e,t,n)=>{n.d(t,{ZP:()=>m});class i{constructor(){this.init("")}init(e){this.src=e,this.p=0}adv(e){this.p+=e}isDone(){return this.p>=this.src.length}c(){return this.src[this.p]}isMatch(e){return this.src.startsWith(e,this.p)}getSpace(){let e="";for(;!this.isDone();){const t=this.c();if(" "!==t&&"\n"!==t&&"\t"!==t)break;e+=t,this.adv(1)}return e}getWord(){let e="";for(;!this.isDone();){const t=this.c(),n=t.charCodeAt();if((n<97||n>122)&&45!==n&&95!==n&&(n<65||n>90)&&(n<48||n>57)&&n<128)break;e+=t,this.adv(1)}return e}getTill(e){const t=this.src.indexOf(e,this.p);if(t<0)throw new SyntaxError("Unexpected end of input");const n=this.src.slice(this.p,t);return this.p=t,n}ignoreTill(e){const t=this.src.indexOf(e,this.p);if(t<0)throw new SyntaxError("Unexpected end of input");this.p=t+e.length}parseTags(){const e=[];for(;!this.isMatch("</");)if(this.isMatch("\x3c!--"))this.ignoreTill("--\x3e");else if(this.isMatch("<![CDATA["))this.adv(9),e.push(this.getTill("]]>")),this.adv(3);else if("<"===this.c())e.push(this.parseTag());else{const t=this.getSpace();"<"!==this.c()&&e.push(t+this.getTill("<"))}return e}parseTag(){this.adv(1);const e={};if(e.t=this.getWord(),""===e.t)throw new SyntaxError("No tag name");if(e.a=this.parseAttrs(),">"===this.c()){if(this.adv(1),e.c=this.parseTags(),this.adv(2),this.getWord()!==e.t)throw new SyntaxError("Start and end tag name do not match");if(this.getSpace(),">"!==this.c())throw new SyntaxError("Tag is not closed");this.adv(1)}else{if(!this.isMatch("/>"))throw new SyntaxError("Tag is not closed");e.c=[],this.adv(2)}return e}parseAttrs(){const e={};for(;;){this.getSpace();const t=this.getWord();if(""===t)break;let n;if("="===this.c()){this.adv(1);const e=this.c();if('"'!==e&&"'"!==e)throw new SyntaxError("Attribute value does not start with \" or '");this.adv(1),n=this.getTill(e),this.adv(1)}else n=t;e[t]=n}return e}parse(e){this.init(e+"</");const t=this.parseTags();if(this.p!==this.src.length-2)throw new SyntaxError("Unexpected end tag");if(1!==t.length)throw new Error("Create only one root element in your template");return this.init(""),t[0]}}function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,t){if(null==t||"function"!=typeof t.onerror)throw e;t.onerror(e)}function o(e,t,n,i){e._f=e._f||{};const o=e._f;r(o,t)||(o[t]=new Function("event",n));const a=o[t].bind(i);return e=>{try{const t=a(e);return null!=t&&"function"==typeof t.catch?t.catch((e=>s(e,i))):t}catch(e){s(e,i)}}}function a(e){if(r(e,"_parsedTemplate"))return;const t=e.prototype.template();null!=t&&(e._parsedTemplate=c.parse(t))}const l=new WeakMap;class c{static parse(e){return(new i).parse(e)}static build(e,t=null,n=Object.create(null)){if("string"==typeof e)return document.createTextNode(e);if(n[e.t]){const i={};for(const[n,r]of Object.entries(e.a))t&&"on"===n.slice(0,2)?i[n]=o(e,n,r,t):t&&"id"!==n&&(i[n]=r);const r=e.c.map((e=>c.build(e,t,n))),s=new n[e.t](i,r);return t&&e.a&&e.a.id&&(t[e.a.id]=s),s.element}{const i=document.createElement(e.t);for(const[n,r]of Object.entries(e.a))t&&"id"===n?t[r]=i:t&&"on"===n.slice(0,2)?i[n]=o(e,n,r,t):i.setAttribute(n,r);for(const r of e.c)i.appendChild(c.build(r,t,n));return i}}static create(e,t={},n=void 0){return c.createElement(e,t,n),t}static createElement(e,t=void 0,n=void 0){const i=c.build(c.parse(e),t,n);return c.bindElement(t,i),i}static bindElement(e,t){null!=e&&null==e.element&&(e.element=t,l.set(t,e))}static from(e){return l.get(e)}static camelToKebab(e){return(e.slice(0,1)+e.slice(1).replace(/([A-Z])/g,"-$1")).toLowerCase()}constructor(){if(a(this.constructor),null!=this.constructor._parsedTemplate){const e=c.build(this.constructor._parsedTemplate,this,this.constructor._SubComponents);c.bindElement(this,e)}}template(){throw new Error('Please override "template()" method in the class extends TComponent')}uses(...e){r(this.constructor,"_SubComponents")||(this.constructor._SubComponents=Object.create(null));const t=this.constructor._SubComponents;for(const n of e)a(n),r(n.prototype,"tagName")||(n.prototype.tagName=n.name),t[n.prototype.tagName]=n,t[c.camelToKebab(n.prototype.tagName)]=n}}c.version="0.2.7";const d=c;function h(e,t,n=""){return(e[t]??n)+""}function u(e,t,n=!1){return null!=e[t]?e[t]===t||!0===e[t]:n}function p(e,t){return"function"==typeof e[t]?e[t]:null}function f(e){return d.from(e)??e}class m extends d{constructor(e={},t=[]){super(e,t),this.constructor._labelForList||(this.constructor._labelForList=function e(t,n,i){if("string"!=typeof t){"label"===t.t&&"string"==typeof t.a.for&&n.push([t.a.for,[...i]]);for(const[r,s]of t.c.entries())i.push(r),e(s,n,i),i.pop()}return n}(this.constructor._parsedTemplate,[],[]));for(const[e,t]of this.constructor._labelForList){let n=this.element;for(const e of t)n=n.childNodes[e];if("LABEL"===n.tagName&&n.getAttribute("for")===e){const t=m.from(this[e])??this[e];if(t instanceof window.HTMLElement){const i=e+"_"+Math.random().toString(36).slice(2);t.setAttribute("id",i),n.setAttribute("for",i)}}}!function(e,t,n=[]){for(const i of n)switch(i.type){case"string":e[i.name]=h(t,i.name,i.default);break;case"boolean":e[i.name]=u(t,i.name,i.default);break;case"function":e[i.name]=p(t,i.name);break;default:throw new Error("Undefied type: "+i.type)}for(const[i,r]of Object.entries(t))if(!n.find((e=>e.name===i)))if("function"==typeof r)e.element[i]=r;else if("class"===i||"style"===i){const t=e.getAttribute(i),n="class"===i?" ":";";e.setAttribute(i,null==t?r:t+n+r)}else e.setAttribute(i,r)}(this,e,this.attrDef),this.client=this.client??this.element;for(const e of t)this.appendChild(e)}get textContent(){return this.client.textContent}set textContent(e){this.client.textContent=e}get innerHTML(){return this.client.innerHTML}set innerHTML(e){this.client.innerHTML=e}get parentNode(){return f(this.element.parentNode)}get childNodes(){return[...this]}get childElementCount(){return this.client.childElementCount}get firstChild(){return f(this.client.firstChild)}get lastChild(){return f(this.client.lastChild)}get previousSibling(){return f(this.element.previousSibling)}get nextSibling(){return f(this.element.nextSibling)}get classList(){return this.element.classList}get style(){return this.element.style}set style(e){this.element.style=e}appendChild(e){return this.client.appendChild(e?.element??e),e}removeChild(e){return this.client.removeChild(e?.element??e),e}insertBefore(e,t){return this.client.insertBefore(e?.element??e,t?.element??t),e}getAttribute(e){return this.element.getAttribute(e)}setAttribute(e,t){return this.element.setAttribute(e,t)}contains(e){return this.element.contains(e.element??e)}addEventListener(e,t,n){return this.element.addEventListener(e,t,n)}removeEventListener(e,t,n){return this.element.removeEventListener(e,t,n)}dispatchEvent(e){const t=this.element.dispatchEvent(e),n="on"+e.type;return"function"==typeof this[n]&&this[n](e),t}querySelector(...e){return this.client.querySelector(...e)}querySelectorAll(...e){return this.client.querySelectorAll(...e)}*[Symbol.iterator](){for(const e of this.client.childNodes)yield f(e)}onerror(e){let t=this.element?.parentNode;for(;null!=t;){const n=m.from(t);if("function"==typeof n?.onerror)return n.onerror(e);t=t.parentNode}throw e}}}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={id:e,exports:{}};return s[e](n,n.exports,a),n.exports}a.m=s,a.amdO={},e=[],a.O=(t,n,i,r)=>{if(!n){var s=1/0;for(d=0;d<e.length;d++){for(var[n,i,r]=e[d],o=!0,l=0;l<n.length;l++)(!1&r||s>=r)&&Object.keys(a.O).every((e=>a.O[e](n[l])))?n.splice(l--,1):(o=!1,r<s&&(s=r));if(o){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,i,r]},a.F={},a.E=e=>{Object.keys(a.F).map((t=>{a.F[t](e)}))},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var r=Object.create(null);a.r(r);var s={};t=t||[null,n({}),n([]),n(n)];for(var o=2&i&&e;"object"==typeof o&&!~t.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,a.d(r,s),r},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},r="haiix-editor:",a.l=(e,t,n,s)=>{if(i[e])i[e].push(t);else{var o,l;if(void 0!==n)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var h=c[d];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==r+n){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",r+n),o.src=e),i[e]=[t];var u=(t,n)=>{o.onerror=o.onload=null,clearTimeout(p);var r=i[e];if(delete i[e],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(n))),t)return t(n)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&!e;)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{a.b=document.baseURI||self.location.href;var e={179:0};a.f.j=(t,n)=>{var i=a.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise(((n,r)=>i=e[t]=[n,r]));n.push(i[2]=r);var s=a.p+a.u(t),o=new Error;a.l(s,(n=>{if(a.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",o.name="ChunkLoadError",o.type=r,o.request=s,i[1](o)}}),"chunk-"+t,t)}},a.F.j=t=>{if(!a.o(e,t)||void 0===e[t]){e[t]=null;var n=document.createElement("link");a.nc&&n.setAttribute("nonce",a.nc),n.rel="prefetch",n.as="script",n.href=a.p+a.u(t),document.head.appendChild(n)}},a.O.j=t=>0===e[t];var t=(t,n)=>{var i,r,[s,o,l]=n,c=0;if(s.some((t=>0!==e[t]))){for(i in o)a.o(o,i)&&(a.m[i]=o[i]);if(l)var d=l(a)}for(t&&t(n);c<s.length;c++)r=s[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(d)},n=self.webpackChunkhaiix_editor=self.webpackChunkhaiix_editor||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),a.nc=void 0,a.O(0,[179],(()=>{[123,8,423,871,712,834].map(a.E)}),5);var l={};(()=>{var e=a(1268),t=a(4857);const n=window.location,i=n.protocol+"//"+n.host+n.pathname.slice(0,n.pathname.lastIndexOf("/"));function r(e,n,r){if(t.Un(),r||!e||!e.onerror){document.body.textContent="";const e=document.createElement("pre");throw e.textContent=(n.stack??n.message).replaceAll(i,"."),document.body.appendChild(e),n}e.onerror(n)}t.dR();const s=e=>Array.isArray(e)?e:Array.from(e);class o{constructor(e){this._ite=e}concat(...e){return new o([this._ite,...e]).flat()}entries(){return this.map(((e,t)=>[t,e]))}every(e,t=null){return!this.map(e,t).map((e=>!!e)).includes(!1)}fill(e,t=0,n=Number.MAX_SAFE_INTEGER){return t<0||n<0?new o(s(this._ite).fill(...arguments)):this.map(((i,r)=>r>=t&&r<n?e:i))}filter(e,t=null){return this.flatMap(((n,i,r)=>e.call(t,n,i,r)?[n]:[]))}find(e,t=null){for(const[n,i]of this.entries())if(e.call(t,i,n,this._ite))return i}findIndex(e,t=null){for(const[n,i]of this.entries())if(e.call(t,i,n,this._ite))return n;return-1}flat(e=1){return new o(function*e(t,n){for(const i of t)n>0&&null!==i&&"function"==typeof i[Symbol.iterator]?yield*e(i,n-1):yield i}(this._ite,e))}flatMap(e,t){return this.map(e,t).flat()}forEach(e,t=null){this.map(e,t).fill(0).indexOf(1)}includes(e,t=0){return this.indexOf(e,t)>=0}indexOf(e,t=0){return t<0?s(this._ite).indexOf(...arguments):this.findIndex(((n,i)=>i>=t&&n===e))}join(e=","){return s(this._ite).join(...arguments)}keys(){return this.map(((e,t)=>t))}lastIndexOf(e,t=void 0){return s(this._ite).lastIndexOf(...arguments)}map(e,t=null){return new o(function*(n,i){for(const r of n)yield e.call(t,r,++i,n)}(this._ite,-1))}reduce(e,t=void 0){let n=t;for(const[t,i]of this.entries())n=0===t&&1===arguments.length?i:e(n,i,t,this._ite);return n}reduceRight(e,t=void 0){return s(this._ite).reduceRight(...arguments)}slice(e=0,t=Number.MAX_SAFE_INTEGER){return new o(e<0||t<0?s(this._ite).slice(...arguments):function*(n,i){for(const r of n){if(++i>=t)return;i>=e&&(yield r)}}(this._ite,-1))}some(e,t=null){return this.map(e,t).map((e=>!!e)).includes(!0)}toString(){return this.join("")}values(){return new o(this._ite)}[Symbol.iterator](){return this._ite[Symbol.iterator]()}}function l(e){if("number"==typeof e)return new o(Array(e).keys());if(e instanceof o)return e;if("function"==typeof e[Symbol.iterator])return new o(e);throw new TypeError("The given argument is not a number or iterable.")}function c(e,t,n,i){if(!t)return;let r;try{r=t.apply(e,n)}catch(t){i&&i.call(e,t)}i&&null!=r&&"function"==typeof r.then&&async function(t){try{await t}catch(t){i.call(e,t)}}(r)}function d(e){return[e.touches?.[0]?.clientX??e.pageX,e.touches?.[0]?.clientY??e.pageY]}function h({ondragstart:e=null,ondrag:t=null,ondragend:n=null,onerror:i=null,cursor:r="",bind:s=null,container:o=document.body}){let a=null;const l=n=>{n.preventDefault();const[l,h]=d(n);a||(a=document.createElement("div"),a.setAttribute("style","position: fixed; top: 0; left: 0; right: 0; bottom: 0;"),r&&(a.style.cursor=r),o.appendChild(a),c(s,e,[l,h,a],i)),c(s,t,[l,h,a],i)},h=e=>{e.preventDefault();const[t,r]=d(e);window.removeEventListener("touchmove",l),window.removeEventListener("touchend",h),window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",h),a&&o.removeChild(a),c(s,n,[t,r,a],i)};window.addEventListener("touchmove",l,{passive:!1}),window.addEventListener("touchend",h,{passive:!1}),window.addEventListener("mousemove",l,{passive:!1}),window.addEventListener("mouseup",h,{passive:!1})}var u=a(4502);function p(e){return e.element||"LI"===e.tagName?e:new m({},[e])}class f extends u.ZP{template(){return this.tagName="t-list",this.attrDef=[{name:"name",type:"string"},{name:"disabled",type:"boolean"},{name:"onmousedown",type:"function"}],'<ul id="client" onmousedown="return this._handleMouseDown(event)"></ul>'}constructor(e={},t=[]){super(e,t),this._current=[...this].find((e=>e.classList.contains("current")))}appendChild(e){return super.appendChild(p(e))}insertBefore(e,t){return super.insertBefore(p(e),t)}get(e){return[...this].find((t=>t.value===e))}set value(e){this.current=this.get(e)}get value(){return this.current?.value}set current(e){if(null!=e){if([...this].indexOf(e)<0||this._current===e)return;e.classList.add("current")}this.current&&this.current.classList.remove("current"),this._current=e,this.dispatchEvent(new window.CustomEvent("change",{detail:e}))}get current(){return this._current}set disabled(e){e?this.classList.add("disabled"):this.classList.remove("disabled")}get disabled(){return this.classList.contains("disabled")}_handleMouseDown(e){if(this.onmousedown&&!1===this.onmousedown(e))return;if(e.defaultPrevented||this.disabled||0!==e.button)return;const t=[...this].find((t=>t.contains(e.target)));t&&(this.current===t||t.disabled||window.requestAnimationFrame((()=>{this.current=t})))}}class m extends u.ZP{template(){return this.tagName="t-list-item",this.attrDef=[{name:"value",type:"string"},{name:"disabled",type:"boolean"},{name:"current",type:"boolean"},{name:"selected",type:"boolean"}],'<li id="client"></li>'}set disabled(e){e?this.classList.add("disabled"):this.classList.remove("disabled")}get disabled(){return this.classList.contains("disabled")}set current(e){e?this.classList.add("current"):this.classList.remove("current")}get current(){return this.classList.contains("current")}set selected(e){e?this.classList.add("selected"):this.classList.remove("selected")}get selected(){return this.classList.contains("selected")}}f.Item=m;const b=f,g="t-component-ui-splitter";(0,t.ZP)(`\n  .${g} {\n    z-index: 1;\n    background: #CCC;\n    cursor: w-resize;\n    width: 1px;\n  }\n  .${g}::after {\n    content: "";\n    display: block;\n    /*background: yellow;*/\n    width: 9px;\n    height: 100%;\n    position: relative;\n    left: -4px;\n  }\n`);class w extends u.ZP{template(){return this.tagName="t-splitter",this.attrDef=[{name:"ondrag",type:"function"}],`\n      <div class="${g}" ontouchstart="return this.handleSplitter(event)" onmousedown="return this.handleSplitter(event)"></div>\n    `}handleSplitter(e){e.preventDefault();const t=this.element.previousElementSibling,[n]=d(e),i=n-window.getComputedStyle(t).width.slice(0,-2);h({cursor:window.getComputedStyle(e.target).cursor,ondrag:e=>{t.style.width=Math.max(0,e-i)+"px",this.ondrag&&this.ondrag()}})}}var v=a(5745);(0,t.ZP)("\n  @font-face {\n    font-family: 'Material Icons';\n    font-style: normal;\n    font-weight: 400;\n    font-display: block;\n    src: url(./resources/vendor/MaterialIcons-Regular.ttf) format('truetype');\n  }\n\n  .material-icons {\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    display: inline-block;\n    line-height: 1;\n    text-transform: none;\n    letter-spacing: normal;\n    word-wrap: normal;\n    white-space: nowrap;\n    direction: ltr;\n    -webkit-font-smoothing: antialiased;\n    text-rendering: optimizeLegibility;\n    -moz-osx-font-smoothing: grayscale;\n    font-feature-settings: 'liga';\n  }\n");const y="my-flie-list-context-menu";(0,t.ZP)(`\n  .${y} {\n    display: inline-block;\n    position: absolute;\n    background: #FFF;\n    border: 1px solid #999;\n    padding: 2px 0;\n    box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);\n  }\n  .${y} > * {\n    display: block;\n    line-height: 22px;\n    padding: 0 10px;\n    border: 1px solid transparent;\n    white-space: nowrap;\n  }\n  .${y} > * > * {\n    vertical-align: middle;\n  }\n  .${y} > * > .material-icons {\n    font-size: 16px;\n    position: relative;\n    top: -2px;\n    left: -6px;\n  }\n  .${y} > hr {\n    border-top: 1px solid #CCC;\n    margin: 4px;\n  }\n  .${y} > .disabled {\n    color: #999;\n  }\n  .${y} > .current:not(.disabled) {\n    border: 1px solid #BDF;\n    background: #DEF;\n  }\n`);class x extends u.ZP{template(){return`\n      <div class="${y}" id="contextMenu"\n        onmousedown="return this.handleMouseDown(event)"\n        onmouseup="return this.handleMouseUp(event)"\n        onmouseleave="return this.handleMouseLeave(event)"\n        oncontextmenu="event.preventDefault()"\n      >\n        ${this.menuTemplate()}\n      </div>\n    `}constructor(e={},t=[]){super(),this._resolve=e.resolve;const[n]=e.arguments;let i=0,r=0;if(n instanceof MouseEvent)i=n.pageX,r=n.pageY;else if(n instanceof HTMLElement){const e=n.getBoundingClientRect();i=e.left,r=e.bottom}this.element.style.top=r+"px",this.element.style.left=i+"px";const s=e=>{this.element.contains(e.target)||o(e)},o=e=>{this.resolve(null)},a=e=>{if(e.target===this.contextMenu||!this.contextMenu.contains(e.target))return;let t=e.target;for(;t.parentNode!==this.contextMenu;)t=t.parentNode;const n=this.current;n!==t&&(n&&n.classList.remove("current"),t.classList.add("current"))},l=e=>{e.stopPropagation();const t=this.current;switch(e.keyCode){case 13:this.resolve(t.dataset.value);break;case 27:this.resolve(null);break;case 38:{const e=this.contextMenu.lastElementChild;if(t){t.classList.remove("current");let n=t;do{if(n=n.previousElementSibling||e,!n.classList.contains("disabled"))break}while(n!==t);n.classList.add("current")}else e.classList.add("current")}break;case 40:{const e=this.contextMenu.firstElementChild;if(t){t.classList.remove("current");let n=t;do{if(n=n.nextElementSibling||e,!n.classList.contains("disabled"))break}while(n!==t);n.classList.add("current")}else e.classList.add("current")}}};this.resolve=e=>{window.removeEventListener("mousedown",s,!0),window.removeEventListener("mousemove",a,!0),window.removeEventListener("blur",o,!0),window.removeEventListener("keydown",l,!0),this._resolve(e)},window.addEventListener("mousedown",s,!0),window.addEventListener("mousemove",a,!0),window.addEventListener("blur",o,!0),window.addEventListener("keydown",l,!0)}get current(){return Array.from(this.contextMenu.children).find((e=>e.classList.contains("current")))}handleMouseDown(e){e.preventDefault()}handleMouseUp(e){if(0!==e.button&&2!==e.button)return;let t=e.target;for(;t&&t.parentNode!==this.element;)t=t.parentNode;t&&!t.classList.contains("disabled")&&this.resolve(t.dataset.value)}handleMouseLeave(e){const t=this.current;t&&t.classList.remove("current")}}function E(e){return v.ZP.create(class extends x{menuTemplate(){return e}})}async function T(e,t,n,i){const r=await function({name:e="",version:t,onupgradeneeded:n=null}){return new Promise(((i,r)=>{const s=self.indexedDB.open(e,t);s.onupgradeneeded=e=>{try{n&&n(s.result,s.transaction,e.oldVersion)}catch(e){r(e)}},s.onsuccess=e=>{i(s.result)},s.onerror=e=>{r(e.target.error)}}))}(e);return await new Promise(((e,s)=>{let o;const a=r.transaction(t,n);a.oncomplete=t=>{r.close(),e(o)},a.onerror=e=>{r.close(),s(e.target.error)};try{o=i(a)}catch(e){a.abort(),r.close(),s(e)}}))}function C(e,t){return new Promise(((n,i)=>{const r=e.add(t);r.onsuccess=e=>{n(r.result)},r.onerror=e=>{i(e.target.error)}}))}function k(e,t){return new Promise(((n,i)=>{const r=e.put(t);r.onsuccess=e=>{n(r.result)},r.onerror=e=>{i(e.target.error)}}))}function F(e,t){return new Promise(((n,i)=>{const r=e.get(t);r.onsuccess=e=>{n(r.result)},r.onerror=e=>{i(e.target.error)}}))}function S({index:e,range:t=null,direction:n="next",forEach:i}){return new Promise(((r,s)=>{let o;const a=e.openCursor(t,n);a.onsuccess=e=>{const t=a.result;if(t){try{o=i(t.value,t)}catch(e){s(e)}t.advance(void 0===o?1:4294967295)}else r(o)},a.onerror=e=>{s(e.target.error)}}))}class _{constructor(e){this.firstTime=!1,this.dbSchema={name:e,version:1,onupgradeneeded:(e,t,n)=>{n<1&&(this.firstTime=!0,e.createObjectStore("files",{keyPath:"id",autoIncrement:!0}).createIndex("path","path",{unique:!0}))}},this.workspace="workspace1/"}initWorkSpaces(){return T(this.dbSchema,["files"],"readwrite",(e=>{const t=e.objectStore("files");for(let e=1;e<=4;e++)C(t,{path:"workspace"+e,label:"ワークスペース"+e,setting:this.createDefaultSetting()})}))}async getAllWorkSpaces(){const e=[];return await T(this.dbSchema,["files"],"readonly",(t=>S({index:t.objectStore("files").index("path"),forEach:t=>{t.path.includes("/")||(t.setting=this.createDefaultSetting(t.setting),e.push(t))}}))),e}async getAllFoldersAndFiles(){const e=[],t=[];return await T(this.dbSchema,["files"],"readonly",(n=>S({index:n.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace),forEach:n=>{if(!n.path.startsWith(this.workspace))return!1;(n=Object.assign({},n,{path:n.path.slice(this.workspace.length)})).file?t.push(n):e.push(n)}}))),{folders:e,files:t}}async getAllFiles(){const e=[];return await T(this.dbSchema,["files"],"readonly",(t=>S({index:t.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace),forEach:t=>{if(!t.path.startsWith(this.workspace))return!1;t=Object.assign({},t,{path:t.path.slice(this.workspace.length)}),e.push(t)}}))),e}async addFiles(e){await T(this.dbSchema,["files"],"readwrite",(t=>{const n=t.objectStore("files");for(const t of e)k(n,Object.assign({},t,{path:this.workspace+t.path}))}))}async removeFile(e){const t=[];return await T(this.dbSchema,["files"],"readwrite",(n=>S({index:n.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace+e),forEach:(n,i)=>{if(!(n.path+"/").startsWith(this.workspace+e+"/"))return!1;i.delete(n),t.push(n.path.slice(this.workspace.length))}}))),t}removeAllFiles(){return T(this.dbSchema,["files"],"readwrite",(e=>S({index:e.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace),forEach:(e,t)=>{if(!e.path.startsWith(this.workspace))return!1;t.delete()}})))}async moveFile(e,t){const n=[];return await T(this.dbSchema,["files"],"readwrite",(i=>S({index:i.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace+e),forEach:(i,r)=>{if(!(i.path+"/").startsWith(this.workspace+e+"/"))return!1;const s=i.path,o=this.workspace+t+i.path.slice((this.workspace+e).length);if(i.path=o,i.file){const e=this.getFileType(s),t=this.getFileType(o);e!==t&&(i.file=new Blob([i.file],{type:t}),i.srcFile=null)}r.update(i),n.push([s.slice(this.workspace.length),o.slice(this.workspace.length)])}}))),n}putFile(e,t,n=null){return T(this.dbSchema,["files"],"readwrite",(i=>S({index:i.objectStore("files").index("path"),range:IDBKeyRange.only(this.workspace+e),forEach(e,i){e.file=t,e.distFile=n,i.update(e)}})))}async getFile(e,t=!1){const n=await T(this.dbSchema,["files"],"readonly",(t=>F(t.objectStore("files").index("path"),this.workspace+e)));return!t&&n?.distFile||n?.file}putWorkSpaceSetting(e){return T(this.dbSchema,["files"],"readwrite",(t=>S({index:t.objectStore("files").index("path"),range:IDBKeyRange.only(this.workspace.slice(0,-1)),forEach(t,n){t.setting=e,n.update(t)}})))}async getWorkSpaceSetting(){const e=await T(this.dbSchema,["files"],"readonly",(e=>F(e.objectStore("files").index("path"),this.workspace.slice(0,-1))));return this.createDefaultSetting(e?.setting)}createDefaultSetting(e){return e??={},e.fileName??="",e.password??="",e.tabs??=[],e.currentTab??=null,e}getFileType(e){return{js:"text/javascript",mjs:"text/javascript",ts:"text/typescript",css:"text/css",html:"text/html",htm:"text/html",json:"application/json",xml:"application/xml",gif:"image/gif",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",svg:"image/svg+xml",txt:"text/plain",md:"text/markdown"}[e.slice(e.lastIndexOf(".")+1)]||null}}const L="t-component-ui-tree";(0,t.ZP)(`\n  .${L} {\n    cursor: default;\n    outline: none;\n    overflow: auto;\n    background: #FFF;\n    color: #000;\n    -webkit-user-select: none; /* for Safari 3+, Safari on iOS 3+ */\n    user-select: none;\n    box-sizing: border-box;\n  }\n  .${L} ul {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n    min-width: max-content;\n  }\n  .${L} li > div {\n    position: relative;\n    white-space: nowrap;\n    height: 24px;\n    line-height: 0;\n  }\n  .${L} li > div > * {\n    vertical-align: middle;\n  }\n  .${L} li > div:first-child::before {\n    content: "";\n    display: inline-block;\n    height: 100%;\n    vertical-align: middle;\n  }\n  .${L} li > div:hover {\n    background: #DEF;\n  }\n  .${L} li.current > div {\n    background: #DDD;\n  }\n  .${L}:focus li.current > div {\n    background: #BDF;\n  }\n  .${L} .expand-icon {\n    display: inline-block;\n    margin-right: 2px;\n    font-size: 18px;\n    color: #666;\n    opacity: 0;\n    transition: opacity .5s;\n  }\n  .${L}:focus .expand-icon,\n  .${L}:hover .expand-icon {\n    opacity: 1;\n  }\n  .${L} .expand-icon:hover {\n    color: #3CF;\n  }\n  .${L} .icon {\n    display: inline-block;\n    margin-right: 4px;\n    font-size: 18px;\n  }\n`);class j extends u.ZP{get textContent(){return super.textContent()}set textContent(e){if(""!==e)throw new Error("Only empty string can be set.");this.client.textContent="",this.current=null}appendChild(e){return this.insertBefore(e,null)}insertBefore(e,t=null){if(!((e=u.ZP.from(e)??e)instanceof M))throw new Error("The object is not a tree item.");super.insertBefore(e,t);const n=this._getIndent();return Number.isNaN(n)||e._setIndent(n+1),e}removeChild(e){if(e.parentNode!==this)throw new Error("The object is not a child of this node.");const t=this.getRootNode();t.current&&e.contains(t.current)&&(t.current=e.nextSibling??e.previousSibling??(this instanceof M?this:null)),super.removeChild(e)}}class M extends j{template(){return this.tagName="t-tree-item",this.attrDef=[{name:"text",type:"string"},{name:"icon",type:"string",default:"folder"},{name:"iconColor",type:"string",default:"#FC9"},{name:"isExpandable",type:"boolean",default:!0}],'\n      <li>\n        <div id="_container">\n          <i id="_expandIcon" class="material-icons expand-icon"></i>\n          <i id="_icon" class="material-icons icon"></i>\n          <span id="_text"></span>\n        </div>\n        <ul id="client" style="display: none;"></ul>\n      </li>\n    '}get text(){return this._text.textContent}set text(e){this._text.textContent=e}get html(){return this._text.innerHTML}set html(e){this._text.innerHTML=e}get icon(){return this._icon.textContent}set icon(e){this._icon.textContent=e}get iconColor(){return this._icon.style.color}set iconColor(e){this._icon.style.color=e}get parentNode(){return u.ZP.from(this.element.parentNode.parentNode)}async expand(){if(!this.isExpandable||this.isExpanded)return;const e=this.getRootNode();if(e.onexpand){if("autorenew"===this._expandIcon.textContent)return;this._expandIcon.textContent="autorenew";const t=new window.CustomEvent("expand",{detail:this});try{await e.onexpand(t)}catch(e){throw this._expandIcon.textContent="chevron_right",e}}this._expandIcon.textContent="expand_more",this.client.style.display="",this.element.classList.add("expanded")}async collapse(){if(!this.isExpanded)return;const e=this.getRootNode();if(e.oncollapse){if("autorenew"===this._expandIcon.textContent)return;this._expandIcon.textContent="autorenew";const t=new window.CustomEvent("collapse",{detail:this});await e.oncollapse(t)}this._expandIcon.textContent="chevron_right",this.client.style.display="none",this.classList.remove("expanded");const t=this.getRootNode();t.current&&this.contains(t.current)&&(t.current=this)}get isExpanded(){return"none"!==this.client.style.display}get isExpandable(){return"_"!==this._expandIcon.textContent}set isExpandable(e){e?this.isExpanded||(this._expandIcon.textContent="chevron_right"):(this._expandIcon.textContent="_",this.client.style.display="none")}getRootNode(){let e=this;for(;e instanceof M;)e=e.parentNode;return e instanceof N?e:null}getPath(){const e=[];let t=this;for(;t instanceof M;)e.unshift(t),t=t.parentNode;return e}_setIndent(e){this._container.style.paddingLeft=e+"em";for(const t of this)t._setIndent(e+1)}_getIndent(){const e=this._container.style.paddingLeft;return""===e?NaN:e.slice(0,-2)>>0}}class N extends j{template(){return this.tagName="t-tree",this.attrDef=[{name:"onexpand",type:"function"},{name:"oncollapse",type:"function"},{name:"onmousedown",type:"function"},{name:"onkeydown",type:"function"}],`\n      <div id="_tree" tabindex="0" class="${L}"\n        onmousedown="return this._handleTreeMousedown(event)"\n        onkeydown="return this._handleTreeKeydown(event)"\n      >\n        <ul id="client"></ul>\n      </div>\n    `}constructor(e={},t=[]){super(e,t),this._lastCurrent=null}getRootNode(){return this}_getIndent(){return-1}get current(){return this._lastCurrent?.classList.contains("current")||(this._lastCurrent=u.ZP.from(this._tree.querySelector(".current"))),this._lastCurrent}set current(e){if(!(e instanceof M)&&null!=e)throw new Error("The object is not a tree item.");this._lastCurrent!==e&&(null!=this._lastCurrent&&this._lastCurrent.classList.remove("current"),this._lastCurrent=e,e&&(e.classList.add("current"),e._container.scrollIntoView({block:"nearest",inline:"nearest"})),this._tree.dispatchEvent(new window.CustomEvent("change",{detail:e})))}focus(){this._tree.focus()}async _handleTreeMousedown(e){if("function"==typeof this.onmousedown&&(!1===this.onmousedown(e)||e.defaultPrevented))return;let t=e.target;for(;"LI"!==t.tagName;){if(t===this._tree)return;t=t.parentNode}const n=u.ZP.from(t);e.target===n._expandIcon&&n.isExpandable?0===e.button&&(n.isExpanded?await n.collapse():await n.expand()):1!==e.button&&(this.current=n)}async _handleTreeKeydown(e){if(("function"!=typeof this.onkeydown||!1!==this.onkeydown(e)&&!e.defaultPrevented)&&this.current)switch(e.keyCode){case 8:e.preventDefault(),this.current.parentNode!==this&&(this.current=this.current.parentNode);break;case 37:e.preventDefault(),this.current.isExpanded?await this.current.collapse():this.current.parentNode!==this&&(this.current=this.current.parentNode);break;case 38:if(e.preventDefault(),this.current.previousSibling){let e=this.current.previousSibling;for(;e.isExpanded&&e.lastChild;)e=e.lastChild;this.current=e}else this.current.parentNode!==this&&(this.current=this.current.parentNode);break;case 39:e.preventDefault(),this.current.isExpandable&&!this.current.isExpanded?await this.current.expand():this.current.firstChild&&(this.current=this.current.firstChild);break;case 40:if(e.preventDefault(),this.current.isExpanded&&this.current.firstChild)this.current=this.current.firstChild;else{let e=this.current;for(;e!==this&&!e.nextSibling;)e=e.parentNode;e!==this&&(this.current=e.nextSibling)}}}}N.Item=M;const P=N,A="my-file-tree";(0,t.ZP)(`\n  .${A} {\n    height: 0;\n    min-height: 100%;\n  }\n  .${A} .drop-target {\n    background: #BDF;\n  }\n`);class I extends P{template(){const e=super.template();return this.tagName="file-tree",e}constructor(...e){super(...e),this.classList.add(A)}update(e,t){this.textContent="";for(const n of[...e,...t]){const[e,t]=this.getFolderAndName(n.path),i=this.createItem(t,!n.file);e.appendChild(i)}}createItem(e,t){const n=new P.Item;return n.text=e,t||(n.isExpandable=!1,n.icon="insert_drive_file",n.iconColor="#CCC"),n}insert(e,t){const n=t.text,i=l(e).find((e=>t.isExpandable?!e.isExpandable||e.text>n:!e.isExpandable&&e.text>n));return e.insertBefore(t,i),t}addFile(e){let t=null;for(const n of e){const[e,i]=this.getFolderAndName(n.path);t=this.createItem(i,!n.file),this.insert(e,t)}t&&(this.current=t)}remove(e){const t=this.getItem(e);t.parentNode.removeChild(t)}move(e,t){const[n,i]=this.getFolderAndName(t),r=this.getItem(e);r.text=i,this.insert(n,r),n!==this&&n.expand()}getFolderAndName(e){const t=e.split("/"),n=t.pop();return[this.getItem(t.join("/"))||this,n]}getItem(e){return e?e.split("/").reduce(((e,t)=>l(e).find((e=>e.text===t))||this.insert(e,this.createItem(t,!0))),this):this}getPath(e=this.current){const t=[];for(;e!==this;)t.unshift(e.text),e=e.parentNode;return t.join("/")}getFolderPath(e=this.current){if(!e)return"";!1===e.isExpandable&&(e=e.parentNode);let t=this.getPath(e);return""!==t&&(t+="/"),t}get currentIsFile(){return this.current&&!this.current.isExpandable}}class O extends b.Item{template(){return(0,t.ZP)("\n      .editor-tabs {\n        border-bottom: 1px solid #999;\n        flex-wrap: wrap;\n        align-items: flex-end;\n      }\n      .editor-tabs > li {\n        padding: 1px 5px 2px;\n        border: 1px solid #999;\n        border-bottom: none;\n        background: #EEE;\n        margin-right: -1px;\n        position: relative;\n        bottom: -1px;\n      }\n      .editor-tabs > li:hover {\n        background: #DEF;\n      }\n      .editor-tabs > li.current {\n        padding-bottom: 4px;\n        background: #FFF;\n      }\n      .editor-tabs > li > * {\n        vertical-align: middle;\n      }\n      .editor-tabs > li.modified > .label::before {\n        content: '*'\n      }\n      .editor-tabs > li .close-button {\n        border: 1px solid transparent;\n        font-size: 12px;\n        padding: 1px;\n        margin-left: 4px;\n      }\n      .editor-tabs > li .close-button:hover {\n        border: 1px solid #CCC;\n      }\n    "),'\n      <li>\n        <span id="label" class="label"></span>\n        <span id="closeButton" class="material-icons close-button">close</span>\n      </li>\n    '}constructor(e={},t=[]){const n=Object.assign({},e);delete n.view,delete n.path,delete n.file,super(n,t),this.view=e.view,this.path=e.path,this.file=e.file,this.editor=null}get isModified(){return this.classList.contains("modified")}set isModified(e){e?this.classList.add("modified"):this.classList.remove("modified")}get path(){return this.value}set path(e){this.value=e,this.label.textContent=this.name,this.view.value=e}get name(){return this.path.slice(("/"+this.path).lastIndexOf("/"))}}function D(e,t){if(t===e)return null;for(;t&&t.parentNode!==e;)t=t.parentNode;return t}function $(e,t,n){const i=e.editor.createModel(t.getValue(),t.getLanguageId(),n),r=n.fsPath,s=n.toString(),o=t._commandManager._undoRedoService._editStacks,a=new Map;function l(e){e.actual.model=i,e.resourceLabel=r,e.resourceLabels=[r],e.strResource=s,e.strResources=[s]}return o.forEach((e=>{e.resourceLabel=r,e.strResource=s,e._future.forEach(l),e._past.forEach(l),a.set(s,e)})),i._commandManager._undoRedoService._editStacks=a,t.dispose(),i}class B extends u.ZP{template(){const e="my-app";return(0,t.ZP)('\nhtml, body {\n  font-family: "Segoe UI", "Yu Gothic UI", "Meiryo UI", "MS UI Gothic", monospace;\n  font-size: 9pt;\n  color: #000;\n  background: #FFF;\n  -webkit-user-select: none; /* for Safari 3+, Safari on iOS 3+ */\n  user-select: none;\n  cursor: default;\n}\nbutton {\n  font-family: inherit;\n  font-size: inherit;\n}\n',"\n.fullscreen {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: auto;\n  outline: none;\n}\n","\n.flex.row {\n  display: flex;\n}\n.flex.column {\n  display: flex;\n  flex-direction: column;\n}\nul.flex.row, ul.flex.column {\n  margin: 0;\n  padding: 0;\n  list-style-type: none;\n}\n.flex.row > *, .flex.column > * {\n  flex: none;\n}\n.flex.fit {\n  flex: auto;\n}\n"),(0,t.ZP)(`\n      .${e} .select-template-button, .select-template-choices button {\n        margin: 0;\n        padding: 0;\n        border: none;\n        text-align: inherit;\n        background: inherit;\n        color: #06C;\n        cursor: pointer;\n      }\n      .${e} .select-template-button:hover, .t-component-ui-dialog a:hover {\n        color: #39F;\n        text-decoration: underline;\n      }\n      .select-template-choices {\n        margin: 0;\n        padding: 0;\n        list-style-type: none;\n      }\n      .select-template-choices button {\n        display: inline-block;\n        box-sizing: border-box;\n        width: 100%;\n        padding: 1em;\n      }\n      .select-template-choices button:hover {\n        background: #DEF;\n      }\n      .${e} .m-icon {\n        font-size: 18px;\n        width: 1em;\n      }\n      .${e} > * {\n        overflow: hidden;\n      }\n      .${e} .menubar {\n        background: #EEE;\n        border-bottom: 1px solid #CCC;\n      }\n      .${e} .menubar > * {\n        padding: 2px 8px;\n        border: 1px solid transparent;\n      }\n      .${e} .menubar > :hover {\n        border: 1px solid #9CF;\n        background: #DEF;\n      }\n      .${e} .menubar > .selected {\n        border: 1px solid #9CF;\n        background: #BDF;\n      }\n      .${e} .side-area {\n        width: 160px;\n      }\n      .${e} .side-area > li:not(.current) {\n        display: none;\n      }\n      .${e} .side-area-empty {\n        justify-content: center;\n        align-items: center;\n        padding: 0 2em;\n      }\n      .${e} .main-area {\n        background: #EEE;\n      }\n      .${e} .main-area > li:not(.current) {\n        display: none;\n      }\n      .${e} .main-area-empty {\n        justify-content: center;\n        align-items: center;\n        padding: 0 4em;\n      }\n      .${e} .tab-views {\n        overflow: hidden;\n      }\n      .${e} .views {\n        background: #EEE;\n      }\n      .${e} .views > li {\n        width: 0;\n        height: 0;\n        min-width: 100%;\n        min-height: 100%;\n        display: none;\n        position: relative;\n        z-index: 0;\n        overflow: auto;\n      }\n      .${e} .views > li.current {\n        display: inline-block;\n      }\n      .${e} .views iframe {\n        border: none;\n        width: 100%;\n        height: calc(100% - 4px);\n      }\n    `),this.uses(I,w,b,b.Item),`\n      <div class="${e} fullscreen flex column"\n        ondragover="return this.handleDragOver(event)"\n        ondrop="return this.handleDrop(event)"\n        onkeydown="return this.handleKeyDown(event)"\n        tabindex="-1"\n      >\n        \x3c!-- メニュー --\x3e\n        <ul id="menubar" class="menubar flex row"\n          onmousedown="return this.handleMenuMouseDown(event)"\n          onclick="return this.handleMenuClick(event)"\n          oncontextmenu="event.preventDefault()"\n        >\n          <li data-key="workspace">ワークスペース▾</li>\n          <li data-key="project">プロジェクト▾</li>\n          <li data-key="run" class="flex row">\n            <i class="material-icons m-icon" style="color: #0A3;">\n              play_circle_outline\n            </i>\n            実行 (F5)\n          </li>\n        </ul>\n\n        <div class="flex row fit">\n          <t-list id="sideArea" class="flex column side-area"\n            oncontextmenu="return this.handleFileTreeContextMenu(event)"\n          >\n            <t-list-item id="sideAreaEmpty" class="flex column fit side-area-empty">\n              <p>\n                ファイルツリーが空です。<br />\n                このエリアで右クリックメニューを開くか、ウィンドウ外からファイルをドロップしてファイルを追加してください。\n                <br />\n                <button class="select-template-button" onclick="return this.handleSelectTemplate(event)">ここをクリックして「index.html」を作成することもできます。</button>\n              </p>\n            </t-list-item>\n            <t-list-item id="fileTreeArea" class="flex column fit current">\n              \x3c!-- ファイルリスト --\x3e\n              <file-tree id="fileTree"\n                ondblclick="return this.handleFileTreeDoubleClick(event)"\n                onmousedown="return this.handleFileTreeMouseDown(event)"\n                onkeydown="return this.handleFileTreeKeyDown(event)"\n              />\n            </t-list-item>\n          </t-list>\n          <t-splitter ondrag="return this.handleDragSplitter(event)" />\n\n          <t-list id="mainArea" class="flex column fit main-area">\n            <t-list-item id="mainAreaLoading" class="flex column fit main-area-empty current" style="background: white;">\n            </t-list-item>\n            <t-list-item id="mainAreaEmpty" class="flex column fit main-area-empty">\n              <p>左のツリーからファイルを選択し、Enterキー、ダブルクリック、またはこのエリアへドラッグ&ドロップしてファイルを開いてください。</p>\n            </t-list-item>\n            \x3c!-- タブとエディタ --\x3e\n            <t-list-item id="tabViews" class="flex column fit tab-views">\n              <t-list id="tabs" class="editor-tabs flex row"\n                onchange="return this.handleTabChange(event)"\n                onmousedown="return this.handleTabMouseDown(event)"\n              ></t-list>\n              <t-list id="views" class="views flex fit row"></t-list>\n            </t-list-item>\n          </t-list>\n        </div>\n      </div>\n    `}constructor(e={},t=[]){super(),this.name=document.title,this.version="0.1.0",this.namespace=location.pathname.slice(1,location.pathname.lastIndexOf("/")),this.base=location.protocol+"//"+location.host+"/"+(""===this.namespace?"":this.namespace+"/"),this.idbFile=new _(this.namespace),this.debugWindow=null,this.projectSetting=null,this.editorModels=Object.create(null)}async init(){window.addEventListener("beforeunload",this.handleClose.bind(this)),window.addEventListener("resize",this.resizeEditor.bind(this)),[this.projectSetting]=await Promise.all([this.idbFile.getWorkSpaceSetting(),this.registerServiceWorker(),this.initMonaco()])}async initMonaco(){this.monaco=await Promise.all([a.e(123),a.e(8)]).then(a.t.bind(a,862,19)),this.monaco.languages.typescript.javascriptDefaults.setEagerModelSync(!0),this.monaco.languages.typescript.typescriptDefaults.setCompilerOptions({moduleResolution:2,target:99})}async main(){this.typescript=await Promise.all([a.e(423),a.e(871)]).then(a.t.bind(a,5423,19)),this.idbFile.firstTime?(await this.idbFile.initWorkSpaces(),await this.createTemplateFiles(2)):(this.refreshFileTreeAndCreateModels(),await this.restoreTabs())}handleClose(e){this.debugWindow&&!this.debugWindow.closed&&this.debugWindow.close()}registerServiceWorker(){if(null==window.navigator.serviceWorker)throw new Error("ServiceWorkerが無効です");return window.navigator.serviceWorker.register("./sw.js")}async refreshFileTreeAndCreateModels(){const{folders:e,files:t}=await this.idbFile.getAllFoldersAndFiles();this.fileTree.update(e,t),this.createEditorModels(t),this.refreshFileTreeArea()}async addFile(...e){for(const t of e){const e=await this.tsTranspile(t.path,t.file);null!=e&&(t.distFile=e)}this.createEditorModels(e),await this.idbFile.addFiles(e),this.fileTree.addFile(e),this.sideArea.current=this.fileTreeArea}async createEditorModels(e){const t=await Promise.all(e.filter((e=>".ts"===e.path.slice(-3)||".js"===e.path.slice(-3)||".mjs"===e.path.slice(-4))).map((e=>this.createEditorModel(e.path,e.file))));for(const e of t)e.setValue(e.getValue())}async deleteCurrentFileOrFolder(){const e=this.fileTree.getPath(),t=await this.idbFile.removeFile(e);for(const e of t){this.editorModels[e]&&(this.editorModels[e].dispose(),delete this.editorModels[e]);const t=this.tabs.get(e);t&&await this.closeTabs([t])}this.fileTree.remove(e),this.refreshFileTreeArea()}async openTab(e,t=!0){if(null==this.tabs.get(e)){const t=await this.idbFile.getFile(e,!0);if(null!=t){const n=new b.Item({value:e}),i=new O({view:n,path:e,file:t});if(t.type.startsWith("image/")){const i=new Image;i.src=URL.createObjectURL(t),i.alt=e,i.onmousedown=e=>e.preventDefault(),n.appendChild(i)}else if(t.type.startsWith("audio/")){const e=new Audio;e.controls=!0,e.src=URL.createObjectURL(t),n.appendChild(e)}else if(t.type.startsWith("video/")){const e=document.createElement("video");e.controls=!0,e.src=URL.createObjectURL(t),n.appendChild(e)}else if("application/pdf"===t.type){const i=document.createElement("iframe");i.title=e,i.src=URL.createObjectURL(t),n.appendChild(i)}else await this.createEditor(i,e),i.editor.focus();this.tabs.appendChild(i),this.views.appendChild(n)}}t&&(this.tabs.value=e,this.mainArea.current=this.tabViews,await this.saveTabs())}async createEditor(e,t){const n=await this.createEditorModel(t,e.file);e.editor=this.monaco.editor.create(e.view.element,{model:n}),e.editor.getModel().onDidChangeContent((e=>{this.tabs.current&&(this.tabs.current.isModified=!0)}))}createEditorModel(e,t){return this.editorModels[e]||(this.editorModels[e]=async function(){const n=this.monaco.editor.createModel(await t.text(),t.type,this.monaco.Uri.parse(this.base+"debug/"+this.idbFile.workspace+e));return n.updateOptions({tabSize:2}),this.editorModels[e]=n,n}.call(this)),this.editorModels[e]}resizeEditor(){const e=this.tabs.current;e&&(e.view.style="width: 0; height: 0;",e.editor.layout(),e.view.style="width: 100%; height: 100%;",e.editor.layout())}async closeTabs(e,t=!0){let n=this.tabs.current;for(const t of[...e])t===this.tabs.current&&(n=t.previousSibling??t.nextSibling),this.tabs.removeChild(t),this.views.removeChild(t.view);this.tabs.value=n?.value,0===this.tabs.childElementCount&&(this.mainArea.current=this.mainAreaEmpty),t&&await this.saveTabs()}async saveTabs(){this.projectSetting.tabs=[...l(this.tabs).map((e=>e.path))],this.projectSetting.currentTab=this.tabs.current?.path,await this.idbFile.putWorkSpaceSetting(this.projectSetting)}async restoreTabs(){for(const e of this.projectSetting.tabs)await this.openTab(e,!1);this.projectSetting.currentTab?await this.openTab(this.projectSetting.currentTab):this.mainArea.current=this.mainAreaEmpty}async saveTab(...e){for(const t of e){if(!t.isModified)continue;const e=t.path,n=new Blob([t.editor.getValue()],{type:this.idbFile.getFileType(t.value)}),i=await this.tsTranspile(e,n,t.editor.getValue());await this.idbFile.putFile(e,n,i),t.isModified=!1}}async tsTranspile(e,t,n=null){if(".ts"!==e.slice(e.lastIndexOf(".")))return;null==n&&(n=await t.text());const i=this.typescript.transpile(n,{inlineSourceMap:!1,module:5,sourceMap:!1,target:"ES2018"},e);return new Blob([i],{type:this.idbFile.getFileType(".js")})}handleDragOver(e){e.preventDefault()}handleDrop(e){return e.preventDefault(),this.addFile(...l(e.dataTransfer.files).map((e=>{const t=this.idbFile.getFileType(e.name)??e.type;return{path:e.name,file:new Blob([e],{type:t})}})))}handleKeyDown(e){switch(e.keyCode){case 83:if(e.ctrlKey)return e.preventDefault(),this.saveTab(this.tabs.current);break;case 116:return e.preventDefault(),this.run()}}async handleSelectTemplate(e){const t=await v.ZP.create(class extends v.ZP{titleTemplate(){return"テンプレートを選択してください"}bodyTemplate(){return'\n          <ul class="select-template-choices">\n            <li><button onclick="this.resolve(1)">1. 「index.html」のみ作成</button></li>\n            <li><button onclick="this.resolve(2)">2. 「index.html」、「style.css」、「main.ts」を作成</button></li>\n          </ul>\n        '}buttonsTemplate(){return'\n          <button onclick="return this.handleCancel(event)">キャンセル</button>\n        '}})();await this.createTemplateFiles(t)}async createTemplateFiles(e){switch(e){case 1:await this.addFile({path:"index.html",file:new Blob(['<!DOCTYPE html>\n<html lang="ja">\n  <head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width,initial-scale=1">\n    <title>My App</title>\n  </head>\n  <body>\n    <p>Hello, World!</p>\n  </body>\n</html>\n'],{type:"text/html"})}),await this.openTab("index.html");break;case 2:await this.addFile({path:"index.html",file:new Blob(['<!DOCTYPE html>\n<html lang="ja">\n  <head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width,initial-scale=1">\n    <title>My App</title>\n    <link rel="stylesheet" href="style.css">\n    <script type="module" src="main"><\/script>\n  </head>\n  <body>\n  </body>\n</html>\n'],{type:"text/html"})},{path:"style.css",file:new Blob(["body {\n}\n"],{type:"text/css"})},{path:"main.ts",file:new Blob(["// ここにコードを書く\ndocument.body.innerHTML = '<h1>Hello, World!</h1>';\n"],{type:"text/typescript"})}),await this.openTab("index.html",!1),await this.openTab("style.css",!1),await this.openTab("main.ts")}}handleFileTreeKeyDown(e){switch(e.keyCode){case 13:return this.command("open");case 46:return this.command("delete");case 113:return this.command("rename")}}handleFileTreeDoubleClick(e){if(!e.target.classList.contains("expand-icon")&&this.fileTree.currentIsFile)return this.openTab(this.fileTree.getPath())}async handleFileTreeContextMenu(e){e.preventDefault();const t=null==this.fileTree.current?'class="disabled"':"",n=await E(`\n      <div data-value="newFile"><i class="material-icons" style="color: #AAC;">note_add</i>新規ファイル</div>\n      <div data-value="newFolder"><i class="material-icons" style="color: #FB8;">create_new_folder</i>新規フォルダー</div>\n      <div data-value="rename" ${t}><i class="material-icons" style="color: #96C;">drive_file_rename_outline</i>名前の変更</div>\n      <div data-value="delete" ${t}><i class="material-icons" style="color: #999;">delete</i>削除</div>\n    `)(e);n&&await this.command(n)}async command(e){switch(e){case"newFile":case"newFolder":{let t=this.fileTree.current;t&&(t.isExpandable||(t=t.parentNode),t!==this.fileTree&&t.expand());const n="newFile"===e?"ファイル":"フォルダー";let i="";for(;;){if(i=await this.inputFileName(`${n}名`,i,`新規${n}`),!i)return;const t=this.idbFile.getFileType(i),r=this.fileTree.getFolderPath()+i,s="newFile"===e?{path:r,file:new Blob([""],{type:t})}:{path:r};try{return await this.addFile(s),void this.fileTree.focus()}catch(e){if("ConstraintError"!==e.name)throw e;await(0,v.Z9)("この場所には同名のファイルまたはフォルダーがあります","エラー")}}}case"rename":{const e=this.fileTree.current.text,t=await this.inputFileName(this.fileTree.currentIsFile?"ファイル名":"フォルダー名",e,"名前の変更");if(!t)return;let n=this.fileTree.getPath(this.fileTree.current.parentNode);return""!==n&&(n+="/"),this.fileListMove(n+e,n+t)}case"delete":if(!await(0,v.iG)((this.fileTree.currentIsFile?"ファイル":"フォルダー")+' "'+this.fileTree.current.text+'" を削除しますか?'))break;return this.deleteCurrentFileOrFolder();case"open":if(!this.fileTree.currentIsFile)return;return this.openTab(this.fileTree.getPath());default:throw new Error("Undefiend command: "+e)}}async inputFileName(e,t,n){for(;;){const i=await(0,v.eB)(e+"を入力してください",t,n);if(!i)return"";let r="";if(l('\\/:*?"<>|').some((e=>i.includes(e)))?r=e+'には次の文字は使えません:\n\\ / : * ? " < > |':"."!==i&&".."!==i||(r="その"+e+"を付けることはできません"),!r)return i;await(0,v.Z9)(r,"注意"),t=i}}async fileListMove(e,t){if(e===t)return;if((t+"/").startsWith(e+"/"))return void await(0,v.Z9)("受け側のフォルダーは、送り側フォルダーのサブフォルダーです。","中断");if(await this.idbFile.getFile(t))return void await(0,v.Z9)("受け側のフォルダーに同名のファイルまたはフォルダーがあります。","中断");const n=await this.idbFile.moveFile(e,t);for(const[e,t]of n){this.editorModels[e]&&(this.editorModels[t]=$(this.monaco,this.editorModels[e],t),delete this.editorModels[e],this.tabs.childNodes.find((t=>t.value===e))?.editor.setModel(this.editorModels[t]));const n=this.tabs.get(e);n&&(n.path=t),await this.saveTabs()}this.fileTree.move(e,t)}async handleFileTreeMouseDown(e){if(1===e.button)return;const t=l(function*(e){for(;e;)yield e,e=e.parentNode}(e.target)).map((e=>u.ZP.from(e))).find((e=>e instanceof I.Item));if(!t)return;let n=null;const i=[];let r=null;h({ondragstart:(e,r,s)=>{n=u.ZP.createElement('\n          <div style="position: absolute; text-align: center; opacity: .75;" class="flex column"></div>\n        '),n.appendChild(t.element.querySelector(".icon").cloneNode(!0)),n.appendChild(t.element.querySelector("span").cloneNode(!0)),s.appendChild(n),function e(t){for(const n of t){const t=n.element.firstElementChild;i.push({item:n,elem:t,rect:t.getBoundingClientRect()}),n.isExpandable&&n.isExpanded&&e(n)}}(this.fileTree),i.push({item:this.fileTree,elem:this.fileTree.element,rect:this.fileTree.element.getBoundingClientRect()}),i.push({item:null,elem:this.mainArea.element,rect:this.mainArea.element.getBoundingClientRect()}),this.fileTree.element.blur()},ondrag:(e,t)=>{n.style.top=t-n.clientWidth/2+"px",n.style.left=e-n.clientHeight/2+"px";const s=i.find((({rect:n})=>e>=n.left&&e<n.left+n.width&&t>=n.top&&t<n.top+n.height));s!==r&&(r&&r.elem.classList.remove("drop-target"),r=s,r&&r.elem.classList.add("drop-target"))},ondragend:(e,n)=>{if(r){if(r.elem.classList.remove("drop-target"),r.elem===this.mainArea.element){if(!this.fileTree.currentIsFile)return;return this.openTab(this.fileTree.getPath())}if(this.fileTree.focus(),r.item===t)return;const e=this.fileTree.getPath(t),n=this.fileTree.getFolderPath(r.item)+t.text;return this.fileListMove(e,n)}},onerror:e=>{this.onerror(e)}})}async handleTabChange(e){const t=this.tabs.current;if(t){if(this.views.value=t.path,document.title=t.path+" - "+this.name,!t.editor)return;requestAnimationFrame((()=>{this.resizeEditor(),t.editor.focus()}))}else document.title=this.name}async handleTabMouseDown(e){if("mousedown"===e.type&&0!==e.button)return;if(e.target.classList.contains("close-button"))return e.preventDefault(),void await this.closeTabs([u.ZP.from(e.target.parentElement)]);let t,n,i;const r=()=>{t=null,requestAnimationFrame((()=>{t=[...l(this.tabs).map(((e,t)=>({idx:t,tab:e,rect:e.element.getBoundingClientRect()})))],n=l(this.tabs).indexOf(this.tabs.current)}))};r(),h({ondrag:(e,s)=>{if(!t)return;const o=t.find((t=>e>=t.rect.left&&e<t.rect.right&&s>=t.rect.top&&s<t.rect.bottom));null!=o&&o!==this.tabs.current?i!==o.tab&&(i=o.tab,this.tabs.insertBefore(this.tabs.current,o.idx<n?o.tab:o.tab.nextSibling),r()):i=null},ondragend:()=>{this.saveTabs()},onerror:e=>{this.onerror(e)}})}handleDragSplitter(){this.resizeEditor()}handleMenuMouseDown(e){if(0!==e.button)return;const t=D(this.menubar,e.target);if(t)switch(t.dataset.key){case"workspace":return this.showWorkSpaceList(e);case"project":return this.showProjectMenu(e)}}async handleMenuClick(e){const t=D(this.menubar,e.target);if(!t)return;const n=t.dataset.key;if(null!=n)switch(n){case"workspace":case"project":return;case"run":return this.run(e);default:throw new Error("Undefiend command: "+n)}}async showWorkSpaceList(e){if(e.target.classList.contains("selected"))return;e.target.classList.add("selected");let t=await this.idbFile.getAllWorkSpaces();0===t.length&&(await this.idbFile.initWorkSpaces(),t=await this.idbFile.getAllWorkSpaces());const n=await E(`\n      ${t.map(((e,t)=>`\n        <div data-value="${t}">\n          <i class="material-icons">${e.path+"/"===this.idbFile.workspace?"check":"_"}</i>\n          ${e.label}\n        </div>\n      `)).join("")}\n    `)(e.target),i=t[n];e.target.classList.remove("selected"),i&&this.idbFile.workspace!==i.path+"/"&&(this.tabs.childElementCount>0&&(await this.closeTabs(this.tabs,!1),this.mainArea.current=this.mainAreaLoading),this.disposeCurrentProject(),this.projectSetting=i.setting,this.idbFile.workspace=i.path+"/",await this.refreshFileTreeAndCreateModels(),await this.restoreTabs())}disposeCurrentProject(){Object.values(this.editorModels).forEach((e=>e.dispose())),this.editorModels=Object.create(null)}async showProjectMenu(e){if(e.target.classList.contains("selected"))return;e.target.classList.add("selected");const t=await E('\n      <div data-value="newProject"><i class="material-icons" style="color: #6A6;">library_add</i>新規プロジェクト</div>\n      <div data-value="loadProject"><i class="material-icons" style="color: #C66;">file_open</i>プロジェクトを開く</div>\n      <div data-value="saveProject"><i class="material-icons" style="color: #66C;">save</i>プロジェクトを保存</div>\n    ')(e.target);switch(e.target.classList.remove("selected"),t){case"newProject":if(!await(0,v.iG)("現在のプロジェクトを閉じますか?\n(保存していないデータは失われます)"))return;return this.newProject();case"loadProject":if(!await(0,v.iG)("現在のプロジェクトを閉じて、別のプロジェクトを開きますか?\n(保存していないデータは失われます)"))return;return this.loadProject();case"saveProject":return this.saveProject()}}async run(){await Promise.all(l(this.tabs).map((e=>this.saveTab(e)))),l(this.fileTree).every((e=>"index.html"!==e.text))?await(0,v.Z9)('"index.html" が無いため実行できません'):this.debugWindow&&!this.debugWindow.closed?(await this.debugWindow.fetch(this.base+"resources/blank.txt"),this.debugWindow.location.replace(this.base+"debug/"+this.idbFile.workspace)):(this.debugWindow=window.open(this.base+"resources/blank.txt","appWindow","width=400,height=400"),this.debugWindow.opener=null,this.debugWindow.onload=async function(){this.debugWindow.location.replace(this.base+"debug/"+this.idbFile.workspace)}.bind(this))}async fetchEZip(){return(await Promise.all([a.e(712),a.e(834)]).then(a.bind(a,4834))).default}async saveProject(){const e=new(await this.fetchEZip())(this.projectSetting);await e.save(async function(){return this.idbFile.getAllFiles()}.bind(this))&&await this.idbFile.putWorkSpaceSetting(this.projectSetting)}async newProject(e=!0){await this.closeTabs(this.tabs,!1),this.disposeCurrentProject(),this.idbFile.removeAllFiles(),this.fileTree.textContent="",this.refreshFileTreeArea(),e&&(this.projectSetting=this.idbFile.createDefaultSetting(),await this.idbFile.putWorkSpaceSetting(this.projectSetting))}refreshFileTreeArea(){0===this.fileTree.childElementCount?this.sideArea.current=this.sideAreaEmpty:this.sideArea.current=this.fileTreeArea}async loadProject(){const e=new(await this.fetchEZip())(this.projectSetting),t=await e.load();t&&(await this.newProject(!1),await this.addFile(...t),await this.idbFile.putWorkSpaceSetting(this.projectSetting))}onerror(e){throw(0,v.Z9)(e.message,"エラー"),e}}!async function(n){let i=null;try{if(i=new n,Object.prototype.hasOwnProperty.call(i,"onerror")||Object.prototype.hasOwnProperty.call(n.prototype,"onerror")||(i.onerror=e=>{r(i,e,!0)}),i.init){const e=i.init();e?.then&&await e}t.Un(),document.body.appendChild(i.element);const s=(0,e.rO)(null,i.element);if(s&&s.focus(),window.app=i,i.main){const e=await i.main();e?.then&&await e}i.loop&&function e(t){try{i.loop(t),window.requestAnimationFrame(e)}catch(e){r(i,e,!1)}}(0)}catch(e){r(i,e,!1)}}(B)})(),l=a.O(l)})();