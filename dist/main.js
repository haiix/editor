(()=>{"use strict";var e,t,n,i={},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,exports:{}};return i[e].call(n.exports,n,n.exports,s),n.exports}s.m=i,e=[],s.O=(t,n,i,r)=>{if(!n){var a=1/0;for(d=0;d<e.length;d++){for(var[n,i,r]=e[d],o=!0,l=0;l<n.length;l++)(!1&r||a>=r)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(o=!1,r<a&&(a=r));if(o){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[n,i,r]},s.F={},s.E=e=>{Object.keys(s.F).map((t=>{s.F[t](e)}))},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>e+".js",s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="haiix-editor:",s.l=(e,i,r,a)=>{if(t[e])t[e].push(i);else{var o,l;if(void 0!==r)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var h=c[d];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==n+r){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,s.nc&&o.setAttribute("nonce",s.nc),o.setAttribute("data-webpack",n+r),o.src=e),t[e]=[i];var u=(n,i)=>{o.onerror=o.onload=null,clearTimeout(p);var r=t[e];if(delete t[e],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(i))),n)return n(i)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{s.b=document.baseURI||self.location.href;var e={179:0};s.f.j=(t,n)=>{var i=s.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var r=new Promise(((n,r)=>i=e[t]=[n,r]));n.push(i[2]=r);var a=s.p+s.u(t),o=new Error;s.l(a,(n=>{if(s.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var r=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+r+": "+a+")",o.name="ChunkLoadError",o.type=r,o.request=a,i[1](o)}}),"chunk-"+t,t)}},s.F.j=t=>{if(!s.o(e,t)||void 0===e[t]){e[t]=null;var n=document.createElement("link");s.nc&&n.setAttribute("nonce",s.nc),n.rel="prefetch",n.as="script",n.href=s.p+s.u(t),document.head.appendChild(n)}},s.O.j=t=>0===e[t];var t=(t,n)=>{var i,r,[a,o,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(i in o)s.o(o,i)&&(s.m[i]=o[i]);if(l)var d=l(s)}for(t&&t(n);c<a.length;c++)r=a[c],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(d)},n=self.webpackChunkhaiix_editor=self.webpackChunkhaiix_editor||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),s.O(0,[179],(()=>{s.E(191),s.E(1)}),5);var a={};function o(e=null,t=null){if(t=t||document.body,!e)return t;if(e.firstElementChild)return e.firstElementChild;for(;e!==t;){if(e.nextElementSibling)return e.nextElementSibling;e=e.parentElement}return null}function l(e=null,t=null){if(e===(t=t||document.body))return null;if(e){if(!e.previousElementSibling)return e.parentElement;e=e.previousElementSibling}else e=t;for(;e.lastElementChild;)e=e.lastElementChild;return e}function c(e){if(!(e instanceof window.HTMLElement))return!1;const t=e.getAttribute("tabIndex");return null==t?"A"===e.tagName?!!e.href:["BUTTON","INPUT","SELECT","TEXTAREA"].includes(e.tagName)&&!e.disabled:t-0>=0}function d(e=null,t=null){let n=1;if(null!=e){const i=Math.max(0,e.tabIndex);for(;e=o(e,t);)if(c(e)&&e.tabIndex===i)return e;if(0===i)return null;e=null,n=i+1}let i=Number.POSITIVE_INFINITY,r=null;for(;e=o(e,t);){if(!c(e))continue;const t=e.tabIndex||Number.MAX_SAFE_INTEGER;t>=n&&i>t&&(i=t,r=e)}return r}function h(e=null,t=null){let n=Number.POSITIVE_INFINITY;if(null!=e){const i=Math.max(0,e.tabIndex);for(;e=l(e,t);)if(c(e)&&e.tabIndex===i)return e;if(1===i)return null;e=null,n=0===i?Number.MAX_SAFE_INTEGER:i-1}let i=-1,r=null;for(;e=l(e,t);){if(!c(e))continue;const t=e.tabIndex||Number.POSITIVE_INFINITY;t<=n&&i<t&&(i=t,r=e)}return r}let u=!1;const p=[];function m(){if(u=!1,0===p.length)return;const e=document.createElement("style");e.textContent=p.join("\n"),document.head.appendChild(e),p.length=0}function f(...e){p.push(...e),u||m()}u=!0;class b{constructor(){this.init("")}init(e){this.src=e,this.p=0}adv(e){this.p+=e}isDone(){return this.p>=this.src.length}c(){return this.src[this.p]}isMatch(e){return this.src.startsWith(e,this.p)}getSpace(){let e="";for(;!this.isDone();){const t=this.c();if(" "!==t&&"\n"!==t&&"\t"!==t)break;e+=t,this.adv(1)}return e}getWord(){let e="";for(;!this.isDone();){const t=this.c(),n=t.charCodeAt();if((n<97||n>122)&&45!==n&&95!==n&&(n<65||n>90)&&(n<48||n>57)&&n<128)break;e+=t,this.adv(1)}return e}getTill(e){let t=this.src.indexOf(e,this.p);t=t<0?this.src.length:t;const n=this.src.slice(this.p,t);return this.p=t,n}ignoreTill(e){const t=this.src.indexOf(e,this.p);if(t<0)throw new SyntaxError("Unexpected end of input");this.p=t+e.length}parseTags(){const e=[];for(;!this.isMatch("</");)if(this.isMatch("\x3c!--"))this.ignoreTill("--\x3e");else if(this.isMatch("<![CDATA["))this.adv(9),e.push(this.getTill("]]>")),this.adv(3);else if("<"===this.c())e.push(this.parseTag());else{const t=this.getSpace();"<"!==this.c()&&e.push(t+this.getTill("<"))}return e}parseTag(){this.adv(1);const e={};if(e.t=this.getWord(),""===e.t)throw new SyntaxError("No tag name");if(e.a=this.parseAttrs(),">"===this.c()){if(this.adv(1),e.c=this.parseTags(),this.adv(2),this.getWord()!==e.t)throw new SyntaxError("Start and end tag name do not match");if(this.getSpace(),">"!==this.c())throw new SyntaxError("Tag is not closed");this.adv(1)}else{if(!this.isMatch("/>"))throw new SyntaxError("Tag is not closed");e.c=[],this.adv(2)}return e}parseAttrs(){const e={};for(;;){this.getSpace();const t=this.getWord();if(""===t)break;let n;if("="===this.c()){this.adv(1);const e=this.c();if('"'!==e&&"'"!==e)throw new SyntaxError("Attribute value does not start with \" or '");this.adv(1),n=this.getTill(e),this.adv(1)}else n=t;e[t]=n}return e}parse(e){this.init(e+"</");const t=this.parseTags();if(this.p!==this.src.length-2)throw new SyntaxError("Unexpected end tag");if(1!==t.length)throw new Error("Create only one root element in your template");return this.init(""),t[0]}}function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e,t){if(null==t||"function"!=typeof t.onerror)throw e;t.onerror(e)}function y(e,t){const n=new Function("event",e).bind(t);return e=>{try{const i=n(e);return null!=i&&"function"==typeof i.catch?i.catch((e=>w(e,t))):i}catch(e){w(e,t)}}}function v(e){if(g(e,"_parsedTemplate"))return;const t=e.prototype.template();null!=t&&(e._parsedTemplate=E.parse(t))}const x=new WeakMap;class E{static parse(e){return(new b).parse(e)}static build(e,t=null,n=Object.create(null)){if("string"==typeof e)return document.createTextNode(e);if(n[e.t]){const i={};for(const[n,r]of Object.entries(e.a))t&&"on"===n.slice(0,2)?i[n]=y(r,t):t&&"id"!==n&&(i[n]=r);const r=e.c.map((e=>E.build(e,t,n))),s=new n[e.t](i,r);return t&&e.a&&e.a.id&&(t[e.a.id]=s),s.element}{const i=document.createElement(e.t);for(const[n,r]of Object.entries(e.a))t&&"id"===n?t[r]=i:t&&"on"===n.slice(0,2)?i[n]=y(r,t):i.setAttribute(n,r);for(const r of e.c)i.appendChild(E.build(r,t,n));return i}}static create(e,t={},n){return E.createElement(e,t,n),t}static createElement(e,t,n){const i=E.build(E.parse(e),t,n);return E.bindElement(t,i),i}static bindElement(e,t){null!=e&&null==e.element&&(e.element=t,x.set(t,e))}static from(e){return x.get(e)}static camelToKebab(e){return(e.slice(0,1)+e.slice(1).replace(/([A-Z])/g,"-$1")).toLowerCase()}constructor(){if(v(this.constructor),null!=this.constructor._parsedTemplate){const e=E.build(this.constructor._parsedTemplate,this,this.constructor._SubComponents);E.bindElement(this,e)}}template(){throw new Error('Please override "template()" method in the class extends TComponent')}uses(...e){g(this.constructor,"_SubComponents")||(this.constructor._SubComponents=Object.create(null));const t=this.constructor._SubComponents;for(const n of e)v(n),g(n.prototype,"tagName")||(n.prototype.tagName=n.name),t[n.prototype.tagName]=n,t[E.camelToKebab(n.prototype.tagName)]=n}}E.version="0.2.6";const T=E,C=e=>Array.isArray(e)?e:Array.from(e);class k{constructor(e){this._ite=e}concat(...e){return new k([this._ite,...e]).flat()}entries(){return this.map(((e,t)=>[t,e]))}every(e,t=null){return!this.map(e,t).map((e=>!!e)).includes(!1)}fill(e,t=0,n=Number.MAX_SAFE_INTEGER){return t<0||n<0?new k(C(this._ite).fill(...arguments)):this.map(((i,r)=>r>=t&&r<n?e:i))}filter(e,t=null){return this.flatMap(((n,i,r)=>e.call(t,n,i,r)?[n]:[]))}find(e,t=null){for(const[n,i]of this.entries())if(e.call(t,i,n,this._ite))return i}findIndex(e,t=null){for(const[n,i]of this.entries())if(e.call(t,i,n,this._ite))return n;return-1}flat(e=1){return new k(function*e(t,n){for(const i of t)n>0&&null!==i&&"function"==typeof i[Symbol.iterator]?yield*e(i,n-1):yield i}(this._ite,e))}flatMap(e,t){return this.map(e,t).flat()}forEach(e,t=null){this.map(e,t).fill(0).indexOf(1)}includes(e,t=0){return this.indexOf(e,t)>=0}indexOf(e,t=0){return t<0?C(this._ite).indexOf(...arguments):this.findIndex(((n,i)=>i>=t&&n===e))}join(e=","){return C(this._ite).join(...arguments)}keys(){return this.map(((e,t)=>t))}lastIndexOf(e,t){return C(this._ite).lastIndexOf(...arguments)}map(e,t=null){return new k(function*(n,i){for(const r of n)yield e.call(t,r,++i,n)}(this._ite,-1))}reduce(e,t){let n=t;for(const[t,i]of this.entries())n=0===t&&1===arguments.length?i:e(n,i,t,this._ite);return n}reduceRight(e,t){return C(this._ite).reduceRight(...arguments)}slice(e=0,t=Number.MAX_SAFE_INTEGER){return new k(e<0||t<0?C(this._ite).slice(...arguments):function*(n,i){for(const r of n){if(++i>=t)return;i>=e&&(yield r)}}(this._ite,-1))}some(e,t=null){return this.map(e,t).map((e=>!!e)).includes(!0)}toString(){return this.join("")}values(){return new k(this._ite)}[Symbol.iterator](){return this._ite[Symbol.iterator]()}}function _(e){if("number"==typeof e)return new k(Array(e).keys());if(e instanceof k)return e;if("function"==typeof e[Symbol.iterator])return new k(e);throw new TypeError("The given argument is not a number or iterable.")}function F(e,t,n,i){if(!t)return;let r;try{r=t.apply(e,n)}catch(t){i&&i.call(e,t)}i&&null!=r&&"function"==typeof r.then&&async function(t){try{await t}catch(t){i.call(e,t)}}(r)}function S({ondragstart:e=null,ondrag:t=null,ondragend:n=null,onerror:i=null,cursor:r="",bind:s=null,container:a=document.body}){let o=null;const l=n=>{o||(o=document.createElement("div"),o.setAttribute("style","position: fixed; top: 0; left: 0; right: 0; bottom: 0;"),r&&(o.style.cursor=r),a.appendChild(o),F(s,e,[n.pageX,n.pageY,o],i)),F(s,t,[n.pageX,n.pageY,o],i)},c=e=>{window.removeEventListener("mousemove",l),window.removeEventListener("mouseup",c),o&&a.removeChild(o),F(s,n,[e.pageX,e.pageY,o],i)};window.addEventListener("mousemove",l),window.addEventListener("mouseup",c)}f("\n  @font-face {\n    font-family: 'Material Icons';\n    font-style: normal;\n    font-weight: 400;\n    font-display: block;\n    src: url(./resources/vendor/MaterialIcons-Regular.ttf) format('truetype');\n  }\n\n  .material-icons {\n    font-family: 'Material Icons';\n    font-weight: normal;\n    font-style: normal;\n    font-size: 24px;\n    display: inline-block;\n    line-height: 1;\n    text-transform: none;\n    letter-spacing: normal;\n    word-wrap: normal;\n    white-space: nowrap;\n    direction: ltr;\n    -webkit-font-smoothing: antialiased;\n    text-rendering: optimizeLegibility;\n    -moz-osx-font-smoothing: grayscale;\n    font-feature-settings: 'liga';\n  }\n");class j extends T{template(){return this.tagName="t-ul","<ul></ul>"}constructor(e={},t=[]){super();for(const e of t){let t=e;e instanceof HTMLLIElement||(t=document.createElement("li"),t.appendChild(e)),this.element.appendChild(t),null==T.from(t)&&(t=new N({},t))}for(const[t,n]of Object.entries(e))"disabled"===t?this[t]=n===t||!0===n:"function"==typeof n?this.element[t]=n:this.element.setAttribute(t,n);this._current=this.items.find((e=>e.current)),this.element.addEventListener("mousedown",this._handleMouseDown.bind(this))}set items(e){this.element.textContent="";for(const t of e){if(!(t instanceof N))throw new Error("Invalid");this.element.appendChild(t.element)}}get items(){return _(this.element.childNodes).map((e=>T.from(e)))}get length(){return this.element.childElementCount}get(e){return this.items.find((t=>t.value===e))}set current(e){if(null!=e){if(this.items.indexOf(e)<0||this.current===e)return;e.current=!0}this.current&&(this.current.current=!1),this._current=e,this.element.dispatchEvent(new CustomEvent("change",{detail:e}))}get current(){return this._current}set value(e){this.current=this.items.find((t=>t.value===e))}get value(){return null==this.current?"":this.current.value}set disabled(e){e?this.element.classList.add("disabled"):this.element.classList.remove("disabled")}get disabled(){return this.element.classList.contains("disabled")}_handleMouseDown(e){if(e.defaultPrevented||this.disabled||0!==e.button)return;const t=this.items.find((t=>t.element.contains(e.target)));t&&(e.stopPropagation(),this.current===t||t.disabled||(this.current=t))}[Symbol.iterator](){return _(this.element.children).map((e=>T.from(e)))[Symbol.iterator]()}}class N extends T{template(){return this.tagName="t-li","<li></li>"}constructor(e={},t=[]){super();for(const e of t)this.element.appendChild(e);this.value=(e.value||"")+"";for(const[t,n]of Object.entries(e))"value"!==t&&("disabled"===t||"current"===t||"selected"===t?this[t]=n===t||!0===n:"function"==typeof n?this.element[t]=n:this.element.setAttribute(t,n))}set disabled(e){e?this.element.classList.add("disabled"):this.element.classList.remove("disabled")}get disabled(){return this.element.classList.contains("disabled")}set current(e){e?this.element.classList.add("current"):this.element.classList.remove("current")}get current(){return this.element.classList.contains("current")}set selected(e){e?this.element.classList.add("selected"):this.element.classList.remove("selected")}get selected(){return this.element.classList.contains("selected")}}class L extends T{template(){const e="t-component-ui-dialog";return f(`\n      .${e} {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        outline: none;\n      }\n      .${e} > .background {\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        z-index: -1;\n      }\n      .${e} > .dialog {\n        background: #FFF;\n        border: 1px solid #999;\n        box-shadow: 0 0 10px rgba(0, 0, 0, 0.25);\n        display: flex;\n        flex-flow: column nowrap;\n        color: #000;\n        background: #FFF;\n      }\n      .${e} > .dialog > .title {\n        flex: none;\n        padding: 4px;\n        color: #000;\n        background: #EEE;\n      }\n      .${e} > .dialog > .body {\n        flex: auto;\n        padding: 10px;\n      }\n      .${e} > .dialog > .buttons {\n        flex: none;\n        display: flex;\n        justify-content: flex-end;\n        padding: 0 5px;\n      }\n      .${e} > .dialog > .buttons > button {\n        width: 75px;\n        margin: 5px;\n        white-space: nowrap;\n      }\n    `),`\n      <div class="${e}" onkeydown="this.handleKeyDown(event)" tabindex="-1">\n        <div class="background"></div>\n        <div class="dialog">\n          <div id="title" class="title">${this.titleTemplate()}</div>\n          <div id="body" class="body">${this.bodyTemplate()}</div>\n          <div id="buttons" class="buttons">${this.buttonsTemplate()}</div>\n        </div>\n      </div>\n    `}titleTemplate(){return""}bodyTemplate(){return""}buttonsTemplate(){return""}constructor(e={},t=[]){super(),this.resolve=e.resolve}handleOK(e){this.resolve(null)}handleCancel(e){this.resolve(null)}handleKeyDown(e){e.stopPropagation();let t=document.activeElement;switch(e.keyCode){case 13:"BUTTON"!==e.target.tagName&&"function"==typeof this.handleOK&&this.handleOK(e);break;case 27:"function"==typeof this.handleCancel&&this.handleCancel(e);break;case 37:case 38:"BUTTON"===t.tagName&&this.buttons.contains(t)&&(t=h(t,this.buttons),t||(t=h(t,this.buttons)),t&&t.focus());break;case 39:case 40:"BUTTON"===t.tagName&&this.buttons.contains(t)&&(t=d(t,this.buttons),t||(t=d(t,this.buttons)),t&&t.focus())}}}function I(e){return async function(...t){await new Promise((e=>window.requestAnimationFrame(e)));const n=document.activeElement;let i,r=null;const s=await new Promise((n=>{i=new e(Object.assign({resolve:n},{arguments:t})),document.body.appendChild(i.element);const s=d(null,i.element);if(s){const e=h(null,i.element);r=T.createElement('<div style="position: absolute; overflow: hidden; width: 0;"><input onfocus="this.handleFocus(event)" tabindex="1" /></div>',{handleFocus(e){s.focus()}}),document.body.insertBefore(r,document.body.firstChild),i.element.addEventListener("keydown",(t=>{if(9===t.keyCode&&!1===t.ctrlKey&&!1===t.altKey){const n=c(t.target);!t.shiftKey||n&&t.target!==s?t.shiftKey||n&&t.target!==e||(t.preventDefault(),s.focus()):(t.preventDefault(),e.focus())}})),s.focus(),s instanceof window.HTMLInputElement&&s.select()}i.main&&i.main()}));return document.body.removeChild(i.element),r&&document.body.removeChild(r),n.focus(),await new Promise((e=>window.requestAnimationFrame(e))),s}}const M=I(class extends L{bodyTemplate(){return'\n      <p id="text" style="white-space: pre-wrap;"></p>\n    '}buttonsTemplate(){return'\n      <button id="okButton" onclick="return this.handleOK(event)">OK</button>\n    '}constructor(e={},t=[]){super(e,t);const[n="",i="情報"]=e.arguments;this.title.textContent=i,this.text.textContent=n}}),A=I(class extends L{bodyTemplate(){return'\n      <p id="text" style="white-space: pre-wrap;"></p>\n    '}buttonsTemplate(){return'\n      <button id="okButton" onclick="return this.handleOK(event)">はい</button>\n      <button onclick="return this.handleCancel(event)">いいえ</button>\n    '}constructor(e={},t=[]){super(e,t);const[n="",i="確認"]=e.arguments;this.title.textContent=i,this.text.textContent=n}handleOK(e){this.resolve(!0)}handleCancel(e){this.resolve(!1)}});class O extends L{bodyTemplate(){return'\n      <form onsubmit="event.preventDefault()">\n        <p id="text" style="white-space: pre-wrap;"></p>\n        <input id="input" />\n      </form>\n    '}buttonsTemplate(){return'\n      <button onclick="return this.handleOK(event)">OK</button>\n      <button onclick="return this.handleCancel(event)">キャンセル</button>\n    '}constructor(e={},t=[]){super(e,t);const[n="",i="",r="入力"]=e.arguments;this.title.textContent=r,this.text.textContent=n,this.input.value=i}handleOK(e){this.resolve(this.input.value)}}const D=I(O);class P extends T{template(){const e="my-flie-list-context-menu";return f(`\n      .${e} {\n        display: inline-block;\n        position: absolute;\n        background: #FFF;\n        border: 1px solid #999;\n        padding: 2px 0;\n        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);\n      }\n      .${e} > * {\n        display: block;\n        line-height: 20px;\n        padding: 0 10px;\n        border: 1px solid transparent;\n        white-space: nowrap;\n      }\n      .${e} > * > * {\n        vertical-align: middle;\n      }\n      .${e} > * > .material-icons {\n        font-size: 16px;\n        position: relative;\n        left: -6px;\n      }\n      .${e} > hr {\n        border-top: 1px solid #CCC;\n        margin: 4px;\n      }\n      .${e} > .current:not(.disabled) {\n        border: 1px solid #BDF;\n        background: #DEF;\n      }\n    `),`\n      <div class="${e}" id="contextMenu"\n        onmousedown="return this.handleMouseDown(event)"\n        onmouseup="return this.handleMouseUp(event)"\n        onmouseleave="return this.handleMouseLeave(event)">\n        ${this.menuTemplate()}\n      </div>\n    `}constructor(e={},t=[]){super(),this._resolve=e.resolve;const[n]=e.arguments;let i=0,r=0;if(n instanceof MouseEvent)i=n.pageX,r=n.pageY;else if(n instanceof HTMLElement){const e=n.getBoundingClientRect();i=e.left,r=e.bottom}this.element.style.top=r+"px",this.element.style.left=i+"px";const s=e=>{this.element.contains(e.target)||a(e)},a=e=>{this.resolve(null)},o=e=>{if(e.target===this.contextMenu||!this.contextMenu.contains(e.target))return;let t=e.target;for(;t.parentNode!==this.contextMenu;)t=t.parentNode;const n=this.current;n!==t&&(n&&n.classList.remove("current"),t.classList.add("current"))},l=e=>{e.stopPropagation();const t=this.current;switch(e.keyCode){case 13:this.resolve(t.dataset.value);break;case 27:this.resolve(null);break;case 38:{const e=this.contextMenu.lastElementChild;if(t){t.classList.remove("current");let n=t;do{if(n=n.previousElementSibling||e,!n.classList.contains("disabled"))break}while(n!==t);n.classList.add("current")}else e.classList.add("current")}break;case 40:{const e=this.contextMenu.firstElementChild;if(t){t.classList.remove("current");let n=t;do{if(n=n.nextElementSibling||e,!n.classList.contains("disabled"))break}while(n!==t);n.classList.add("current")}else e.classList.add("current")}}};this.resolve=e=>{window.removeEventListener("mousedown",s,!0),window.removeEventListener("mousemove",o,!0),window.removeEventListener("blur",a,!0),window.removeEventListener("keydown",l,!0),this._resolve(e)},window.addEventListener("mousedown",s,!0),window.addEventListener("mousemove",o,!0),window.addEventListener("blur",a,!0),window.addEventListener("keydown",l,!0)}get current(){return Array.from(this.contextMenu.children).find((e=>e.classList.contains("current")))}handleMouseDown(e){e.preventDefault()}handleMouseUp(e){let t=e.target;for(;t&&t.parentNode!==this.element;)t=t.parentNode;t&&!t.classList.contains("disabled")&&this.resolve(t.dataset.value)}handleMouseLeave(e){const t=this.current;t&&t.classList.remove("current")}}function $(e){return I(class extends P{menuTemplate(){return e}})}const B="t-component-ui-tree";f(`\n  .${B} {\n    cursor: default;\n    outline: none;\n    overflow: auto;\n    background: #FFF;\n    color: #000;\n    user-select: none;\n  }\n  .${B} ul {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n    min-width: max-content;\n  }\n  .${B} li > div {\n    white-space: nowrap;\n    height: 24px;\n    line-height: 0;\n  }\n  .${B} li > div > * {\n    vertical-align: middle;\n  }\n  .${B} li > div:first-child::before {\n    content: "";\n    display: inline-block;\n    height: 100%;\n    vertical-align: middle;\n  }\n  .${B} li > div:hover {\n    background: #DEF;\n  }\n  .${B} li.current > div {\n    background: #DDD;\n  }\n  .${B}:focus li.current > div {\n    background: #BDF;\n  }\n  .${B} .expand-icon {\n    display: inline-block;\n    margin-right: 2px;\n    font-size: 18px;\n    color: #666;\n    opacity: 0;\n    transition: opacity .5s;\n  }\n  .${B}:focus .expand-icon,\n  .${B}:hover .expand-icon {\n    opacity: 1;\n  }\n  .${B} .expand-icon:hover {\n    color: #3CF;\n  }\n  .${B} .icon {\n    display: inline-block;\n    margin-right: 4px;\n    font-size: 18px;\n  }\n`);class W extends T{set textContent(e){if(""!==e)throw new Error("Only empty string can be set.");this._list.textContent="",this.current=null}get textContent(){return this.element.textContent}get firstChild(){return T.from(this._list.firstChild)}get lastChild(){return T.from(this._list.lastChild)}appendChild(e){return this.insertBefore(e,null)}insertBefore(e,t=null){if(!(e instanceof R))throw new Error("The object is not a tree item.");this._list.insertBefore(e._item,t?t._item:null);const n=this._getIndent();return Number.isNaN(n)||e._setIndent(n+1),e}removeChild(e){if(e.parentNode!==this)throw new Error("The object is not a child of this node.");const t=this.getRootNode();t.current&&e._item.contains(t.current._item)&&(t.current=e.nextSibling||e.previousSibling||(this instanceof R?this:null)),this._list.removeChild(e.element)}get childElementCount(){return this._list.childElementCount}*[Symbol.iterator](){let e=this._list.firstChild;for(;e;)yield T.from(e),e=e.nextSibling}}class R extends W{template(){return this.tagName="ui-tree-item",'\n      <li id="_item">\n        <div id="_container">\n          <i id="_expandIcon" class="material-icons expand-icon">chevron_right</i>\n          <i id="_icon" class="material-icons icon" style="color: #FC9;">folder</i>\n          <span id="_text"></span>\n        </div>\n        <ul id="_list" style="display: none;"></ul>\n      </li>\n    '}set text(e){this._text.textContent=e}get text(){return this._text.textContent}set html(e){this._text.innerHTML=e}get html(){return this._text.innerHTML}set icon(e){this._icon.textContent=e}get icon(){return this._icon.textContent}set iconColor(e){this._icon.style.color=e}get iconColor(){return this._icon.style.color}get parentNode(){return T.from(this._item.parentNode.parentNode)}get previousSibling(){return T.from(this._item.previousSibling)}get nextSibling(){return T.from(this._item.nextSibling)}async expand(){const e=this.getRootNode();if(e.onexpand){this._expandIcon.textContent="autorenew";const t=new window.CustomEvent("expand",{detail:this});await e.onexpand(t)}this._expandIcon.textContent="expand_more",this._list.style.display="",this._item.classList.add("expanded")}async collapse(){const e=this.getRootNode();if(e.oncollapse){this._expandIcon.textContent="autorenew";const t=new window.CustomEvent("collapse",{detail:this});await e.oncollapse(t)}this._expandIcon.textContent="chevron_right",this._list.style.display="none",this._item.classList.remove("expanded");const t=this.getRootNode();t.current&&this._item.contains(t.current._item)&&(t.current=this)}get isExpanded(){return"none"!==this._list.style.display}set isExpandable(e){e?this._expandIcon.textContent="chevron_right":(this._expandIcon.textContent="_",this._list.style.display="none")}get isExpandable(){return"_"!==this._expandIcon.textContent}getRootNode(){let e=this;for(;e instanceof R;)e=e.parentNode;return e instanceof K?e:null}getPath(){const e=[];let t=this;for(;t instanceof R;)e.unshift(t),t=t.parentNode;return e}_setIndent(e){this._container.style.paddingLeft=e+"em";for(const t of this)t._setIndent(e+1)}_getIndent(){const e=this._container.style.paddingLeft;return""===e?NaN:e.slice(0,-2)>>0}}class K extends W{template(){return this.tagName="ui-tree",'\n      <div id="_tree" tabindex="0"\n        onmousedown="this._handleTreeMousedown(event)"\n        onkeydown="this._handleTreeKeydown(event)"\n      >\n        <ul id="_list"></ul>\n      </div>\n    '}constructor(e,t){super(),this.current=null,this.onexpand=null,this.oncollapse=null,this.onmousedown=null,this.onkeydown=null;for(const[t,n]of Object.entries(e))"string"==typeof n?this._tree.setAttribute(t,n):"on"===t.slice(0,2)&&"onexpand"!==t&&"oncollapse"!==t&&"onmousedown"!==t&&"onkeydown"!==t?this._tree[t]=n:this[t]=n;this._tree.classList.add(B)}getRootNode(){return this}_getIndent(){return-1}set current(e){if(!(e instanceof R)&&null!=e)throw new Error("The object is not a tree item.");this._lastCurrent!==e&&(null!=this._lastCurrent&&this._lastCurrent._item.classList.remove("current"),this._lastCurrent=e,e&&(e._item.classList.add("current"),e._container.scrollIntoView({block:"nearest",inline:"nearest"})),this._tree.dispatchEvent(new window.CustomEvent("change",{detail:e})))}get current(){return null!=this._lastCurrent&&this._lastCurrent._item.classList.contains("current")||(this._lastCurrent=T.from(this._tree.querySelector(".current"))),this._lastCurrent}focus(){this._tree.focus()}async _handleTreeMousedown(e){if("function"==typeof this.onmousedown&&(!1===this.onmousedown(e)||e.defaultPrevented))return;let t=e.target;for(;"LI"!==t.tagName;){if(t===this._tree)return;t=t.parentNode}const n=T.from(t);e.target===n._expandIcon&&n.isExpandable?0===e.button&&(n.isExpanded?await n.collapse():await n.expand()):1!==e.button&&(this.current=n)}async _handleTreeKeydown(e){if(("function"!=typeof this.onkeydown||!1!==this.onkeydown(e)&&!e.defaultPrevented)&&this.current)switch(e.keyCode){case 8:e.preventDefault(),this.current.parentNode!==this&&(this.current=this.current.parentNode);break;case 37:e.preventDefault(),this.current.isExpanded?await this.current.collapse():this.current.parentNode!==this&&(this.current=this.current.parentNode);break;case 38:if(e.preventDefault(),this.current._item.previousSibling){let e=T.from(this.current._item.previousSibling);for(;e.isExpanded&&e._list.lastChild;)e=T.from(e._list.lastChild);this.current=e}else this.current.parentNode!==this&&(this.current=this.current.parentNode);break;case 39:e.preventDefault(),this.current.isExpandable&&!this.current.isExpanded?await this.current.expand():this.current._list.firstChild&&(this.current=T.from(this.current._list.firstChild));break;case 40:if(e.preventDefault(),this.current.isExpanded&&this.current._list.firstChild)this.current=T.from(this.current._list.firstChild);else{let e=this.current;for(;e!==this&&!e._item.nextSibling;)e=e.parentNode;e!==this&&(this.current=T.from(e._item.nextSibling))}}}}async function z(e,t,n,i){const r=await function({name:e="",version:t=1,onupgradeneeded:n=null}){return new Promise(((i,r)=>{const s=self.indexedDB.open(e,t);s.onupgradeneeded=e=>{try{n(s.result,s.transaction,e.oldVersion)}catch(e){r(e)}},s.onsuccess=e=>{i(s.result)},s.onerror=e=>{r(e.target.error)}}))}(e);return await new Promise(((e,s)=>{let a;const o=r.transaction(t,n);o.oncomplete=t=>{r.close(),e(a)},o.onerror=e=>{r.close(),s(e.target.error)};try{a=i(o)}catch(e){o.abort(),r.close(),s(e)}}))}function U(e,t){return new Promise(((n,i)=>{const r=e.add(t);r.onsuccess=e=>{n(r.result)},r.onerror=e=>{i(e.target.error)}}))}function Z(e,t){return new Promise(((n,i)=>{const r=e.put(t);r.onsuccess=e=>{n(r.result)},r.onerror=e=>{i(e.target.error)}}))}function q(e,t){return new Promise(((n,i)=>{const r=e.get(t);r.onsuccess=e=>{n(r.result)},r.onerror=e=>{i(e.target.error)}}))}function X({index:e,range:t=null,direction:n="next",forEach:i}){return new Promise(((r,s)=>{let a;const o=e.openCursor(t,n);o.onsuccess=e=>{const t=o.result;if(t){try{a=i(t.value,t)}catch(e){s(e)}t.advance(void 0===a?1:4294967295)}else r(a)},o.onerror=e=>{s(e.target.error)}}))}K.Item=R;class V{constructor(e){this.firstTime=!1,this.dbSchema={name:e,version:1,onupgradeneeded:(e,t,n)=>{n<1&&(this.firstTime=!0,e.createObjectStore("files",{keyPath:"id",autoIncrement:!0}).createIndex("path","path",{unique:!0}))}},this.workspace="workspace1/"}initWorkSpaces(){return z(this.dbSchema,["files"],"readwrite",(e=>{const t=e.objectStore("files");for(let e=1;e<=4;e++)U(t,{path:"workspace"+e,label:"ワークスペース"+e,setting:this.createDefaultSetting()})}))}async getAllWorkSpaces(){const e=[];return await z(this.dbSchema,["files"],"readonly",(t=>X({index:t.objectStore("files").index("path"),forEach:t=>{t.path.includes("/")||(t.setting=this.createDefaultSetting(t.setting),e.push(t))}}))),e}async getAllFoldersAndFiles(){const e=[],t=[];return await z(this.dbSchema,["files"],"readonly",(n=>X({index:n.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace),forEach:n=>{if(!n.path.startsWith(this.workspace))return!1;(n=Object.assign({},n,{path:n.path.slice(this.workspace.length)})).file?t.push(n):e.push(n)}}))),{folders:e,files:t}}async getAllFiles(){const e=[];return await z(this.dbSchema,["files"],"readonly",(t=>X({index:t.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace),forEach:t=>{if(!t.path.startsWith(this.workspace))return!1;t=Object.assign({},t,{path:t.path.slice(this.workspace.length)}),e.push(t)}}))),e}async addFiles(e){await z(this.dbSchema,["files"],"readwrite",(t=>{const n=t.objectStore("files");for(const t of e)Z(n,Object.assign({},t,{path:this.workspace+t.path}))}))}async removeFile(e){const t=[];return await z(this.dbSchema,["files"],"readwrite",(n=>X({index:n.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace+e),forEach:(n,i)=>{if(!(n.path+"/").startsWith(this.workspace+e+"/"))return!1;i.delete(n),t.push(n.path.slice(this.workspace.length))}}))),t}removeAllFiles(){return z(this.dbSchema,["files"],"readwrite",(e=>X({index:e.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace),forEach:(e,t)=>{if(!e.path.startsWith(this.workspace))return!1;t.delete()}})))}async moveFile(e,t){const n=[];return await z(this.dbSchema,["files"],"readwrite",(i=>X({index:i.objectStore("files").index("path"),range:IDBKeyRange.lowerBound(this.workspace+e),forEach:(i,r)=>{if(!(i.path+"/").startsWith(this.workspace+e+"/"))return!1;const s=i.path,a=this.workspace+t+i.path.slice((this.workspace+e).length);if(i.path=a,i.file){const e=this.getFileType(s),t=this.getFileType(a);e!==t&&(i.file=new Blob([i.file],{type:t}))}r.update(i),n.push([s.slice(this.workspace.length),a.slice(this.workspace.length)])}}))),n}putFile(e,t){return z(this.dbSchema,["files"],"readwrite",(n=>X({index:n.objectStore("files").index("path"),range:IDBKeyRange.only(this.workspace+e),forEach(e,n){e.file=t,n.update(e)}})))}async getFile(e){return(await z(this.dbSchema,["files"],"readonly",(t=>q(t.objectStore("files").index("path"),this.workspace+e))))?.file}putWorkSpaceSetting(e){return z(this.dbSchema,["files"],"readwrite",(t=>X({index:t.objectStore("files").index("path"),range:IDBKeyRange.only(this.workspace.slice(0,-1)),forEach(t,n){t.setting=e,n.update(t)}})))}async getWorkSpaceSetting(){const e=await z(this.dbSchema,["files"],"readonly",(e=>q(e.objectStore("files").index("path"),this.workspace.slice(0,-1))));return this.createDefaultSetting(e?.setting)}createDefaultSetting(e){return e??={},e.fileName??="",e.password??="",e.tabs??=[],e.currentTab??=null,e}getFileType(e){return{js:"text/javascript",mjs:"text/javascript",css:"text/css",html:"text/html",htm:"text/html",json:"application/json",xml:"application/xml",gif:"image/gif",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",svg:"image/svg+xml",txt:"text/plain",md:"text/markdown"}[e.slice(e.lastIndexOf(".")+1)]||null}}class Y extends K{template(){const e=super.template();return this.tagName="file-tree",e}update(e,t){this.textContent="";for(const n of[...e,...t]){const[e,t]=this.getFolderAndName(n.path),i=this.createItem(t,!n.file);e.appendChild(i)}}createItem(e,t){const n=new K.Item;return n.text=e,t||(n.isExpandable=!1,n.icon="insert_drive_file",n.iconColor="#CCC"),n}insert(e,t){const n=t.text,i=_(e).find((e=>t.isExpandable?!e.isExpandable||e.text>n:!e.isExpandable&&e.text>n));return e.insertBefore(t,i),t}addFile(e){let t=null;for(const n of e){const[e,i]=this.getFolderAndName(n.path);t=this.createItem(i,!n.file),this.insert(e,t)}t&&(this.current=t)}remove(e){const t=this.getItem(e);t.parentNode.removeChild(t)}move(e,t){const[n,i]=this.getFolderAndName(t),r=this.getItem(e);r.text=i,this.insert(n,r),n!==this&&n.expand()}getFolderAndName(e){const t=e.split("/"),n=t.pop();return[this.getItem(t.join("/"))||this,n]}getItem(e){return e?e.split("/").reduce(((e,t)=>_(e).find((e=>e.text===t))||this.insert(e,this.createItem(t,!0))),this):this}getPath(e=this.current){const t=[];for(;e!==this;)t.unshift(e.text),e=e.parentNode;return t.join("/")}getFolderPath(e=this.current){if(!e)return"";!1===e.isExpandable&&(e=e.parentNode);let t=this.getPath(e);return""!==t&&(t+="/"),t}}const H=".zip",G=I(class extends L{constructor(e={},t=[]){super(e,t),this.form.name.value=e.arguments[1];const n=e.arguments[2];n&&(this.form["confirm-password"].value=n,this.form.password.value=n,this.details.open=!0)}titleTemplate(){return"プロジェクトを保存"}bodyTemplate(){const e="my-save-dialog-body";return f(`\n      .${e} label {\n        display: block;\n        white-space: nowrap;\n        height: 24px;\n      }\n      .${e} label > span {\n        display: inline-block;\n        width: 100px;\n      }\n      .${e} details {\n        margin-top: 8px;\n      }\n      .${e} summary {\n        height: 24px;\n        color: #08E;\n        cursor: pointer;\n      }\n      .${e} summary:hover {\n        text-decoration: underline;\n      }\n    `),`\n      <form id="form" class="${e}" onsubmit="event.preventDefault()">\n        <label>\n          <span>ファイル名:</span>\n          <input name="name" /> .zip\n        </label>\n        <details id="details">\n          <summary tabindex="-1">オプション</summary>\n          <label>\n            <span>パスワード:</span>\n            <input type="password" name="password" autocomplete="none" />\n          </label>\n          <label>\n            <span>パスワード(確認):</span>\n            <input type="password" name="confirm-password" autocomplete="none" />\n          </label>\n        </details>\n      </form>\n    `}buttonsTemplate(){return'\n      <button onclick="return this.handleOK(event)">OK</button>\n      <button onclick="return this.handleCancel(event)">キャンセル</button>\n    '}handleOK(e){this.resolve(Array.from(this.form.elements).reduce(((e,t)=>(e[t.name]=t.value,e)),{}))}}),J=I(class extends O{bodyTemplate(){return'\n      <form onsubmit="event.preventDefault()">\n        <p id="text" style="white-space: pre-wrap;"></p>\n        <input id="input" type="password" name="password" autocomplete="none" />\n      </form>\n    '}});class Q{constructor(e){this.setting=e}async save(e){const t=".zip"===this.setting.fileName.slice(-4)?this.setting.fileName.slice(0,-4):this.setting.fileName,n=await G("",t,this.setting.password);if(!n)return!1;if(n.password!==n["confirm-password"])throw new Error("パスワードが一致しません");const i=(n.name||"untitled")+(n.name.slice(-4)===H?"":H),r=n.password,s=await e(),a=await this.createEncryptedZipBlob(r,s);return this.downloadFile(i,a),this.setting.fileName=i,this.setting.password=r,!0}async createEncryptedZipBlob(e,t){const n=await this.createZip(t,{level:e?0:5});return e?await this.createZip([{path:"encrypted.zip",file:n}],{password:e,level:5}):n}async createZip(e,t){const n=new zip.BlobWriter("application/zip"),i=new zip.ZipWriter(n,t);for(const{file:t,path:n}of e){const e={};e.directory=!t,await i.add(n,t?new zip.BlobReader(t):null,e)}return await i.close(),await n.getData()}async downloadFile(e,t){const n=URL.createObjectURL(t);T.createElement(`<a href="${n}" download="${e}"></a>`).click(),URL.revokeObjectURL(n)}async load(e){const t=await async function(e="",t=!1){return await new Promise((n=>{const i=T.createElement(`<input type="file" accept="${e}" ${t?"multiple":""} hidden />`);i.onchange=e=>{n(t?i.files:i.files[0])},window.addEventListener("focus",(function e(t){window.removeEventListener("focus",e),setTimeout(n,1e3,null)})),document.body.appendChild(i),i.click(),document.body.removeChild(i)}))}(H);if(t)return this.setting.fileName=t.name,await this.readEncryptedZipFile(t)}async readEncryptedZipFile(e){try{const t=await this.readZip(e);return 1===t.length&&"encrypted.zip"===t[0].path?await this.readZip(t[0].file):t}catch(e){throw new Error("ファイルを開けません:\n"+e.message)}}async readZip(e,t={}){const n=new zip.ZipReader(new zip.BlobReader(e)),i=await n.getEntries();let r="";for(const e of i){const t=e.filename.indexOf("/");if(""===r){if(t<0)break;r=e.filename.slice(0,t+1)}else if(t<0||e.filename.slice(0,t+1)!==r){r="";break}}return await Promise.all(i.filter((e=>!e.directory&&e.filename!==r)).map(async function(e){if(!t.password&&e.encrypted){const e=await J("パスワードを入力してください。");if(null==e)return;t.password=e,this.setting.password=e}return{path:("/"===e.filename.slice(-1)?e.filename.slice(0,-1):e.filename).slice(r.length),file:e.directory?null:await e.getData(new zip.BlobWriter(this.getMimeFromExt(e.filename)),t)}}.bind(this)))}getMimeFromExt(e){return{js:"text/javascript",mjs:"text/javascript",css:"text/css",html:"text/html",htm:"text/html",json:"application/json",xml:"application/xml",gif:"image/gif",png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg",svg:"image/svg+xml",txt:"text/plain",md:"text/markdown"}[e.slice(e.lastIndexOf(".")+1)]||null}}function ee(e,t){if(t===e)return null;for(;t&&t.parentNode!==e;)t=t.parentNode;return t}f('\nhtml, body {\n  font-family: "Segoe UI", "Yu Gothic UI", "Meiryo UI", "MS UI Gothic", monospace;\n  font-size: 9pt;\n  color: #000;\n  background: #FFF;\n  user-select: none;\n  cursor: default;\n}\nbutton {\n  font-family: inherit;\n  font-size: inherit;\n}\n',"\n.fullscreen {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: auto;\n  outline: none;\n}\n","\n.flex.row {\n  display: flex;\n}\n.flex.column {\n  display: flex;\n  flex-direction: column;\n}\nul.flex.row, ul.flex.column {\n  margin: 0;\n  padding: 0;\n  list-style-type: none;\n}\n.flex.row > *, .flex.column > * {\n  flex: none;\n}\n.flex.fit {\n  flex: auto;\n}\n");const te=$('\n  <div data-value="newFile">新規ファイル</div>\n  <div data-value="newFolder">新規フォルダー</div>\n  <div data-value="rename">名前の変更</div>\n  <div data-value="delete">削除</div>\n');class ne extends N{template(){return'\n      <li>\n        <span id="label" class="label"></span>\n        <span id="closeButton" class="material-icons close-button">close</span>\n      </li>\n    '}constructor(e={},t=[]){const n=Object.assign({},e);delete n.view,delete n.path,delete n.file,super(n,t),this.view=e.view,this.path=e.path,this.file=e.file,this.editor=null}get isModified(){return this.element.classList.contains("modified")}set isModified(e){const t=this.element.classList;e?t.add("modified"):t.remove("modified")}get path(){return this.value}set path(e){this.value=e,this.label.textContent=this.name,this.view.value=e}get name(){return this.path.slice(("/"+this.path).lastIndexOf("/"))}}!async function(e){let t=null;try{t=new e,t.init&&await t.init(),m(),document.body.appendChild(t.element);const n=d(null,t.element);n&&n.focus(),t.main&&await t.main(),window.app=t,t.loop&&function e(n){try{t.loop(n)}catch(e){if(m(),!t.onerror)throw e;t.onerror(e)}window.requestAnimationFrame(e)}(0)}catch(n){if(m(),t&&t.onerror)t.onerror(n);else{if(!e.prototype.onerror)throw n;e.prototype.onerror.call(null,n)}}}(class extends T{template(){return f("\n      .my-app a {\n        color: #39F;\n        cursor: pointer;\n      }\n      .my-app a:hover {\n        text-decoration: underline;\n      }\n      .my-app .m-icon {\n        font-size: 18px;\n        width: 1em;\n      }\n      .my-app > * {\n        overflow: hidden;\n      }\n      .my-app .menubar {\n        background: #EEE;\n        border-bottom: 1px solid #CCC;\n      }\n      .my-app .menubar > * {\n        padding: 2px 8px;\n        border: 1px solid transparent;\n      }\n      .my-app .menubar > :hover {\n        border: 1px solid #9CF;\n        background: #DEF;\n      }\n      .my-app .menubar > .selected {\n        border: 1px solid #9CF;\n        background: #BDF;\n      }\n      .my-app .side-area > li:not(.current) {\n        display: none;\n      }\n      .my-app .side-area-empty {\n        justify-content: center;\n        align-items: center;\n        padding: 0 2em;\n      }\n      .my-app .file-tree {\n        height: 0;\n        min-height: 100%;\n      }\n      .my-app .file-tree .drop-target {\n        background: #BDF;\n      }\n      .my-app .splitter {\n        z-index: 4;\n        background: #CCC;\n        cursor: w-resize;\n        width: 1px;\n      }\n      .my-app .splitter::after {\n        content: \"\";\n        display: block;\n        /*background: yellow;*/\n        width: 9px;\n        height: 100%;\n        position: relative;\n        left: -4px;\n      }\n      .my-app .main-area {\n        background: #EEE;\n      }\n      .my-app .main-area > li:not(.current) {\n        display: none;\n      }\n      .my-app .main-area-empty {\n        justify-content: center;\n        align-items: center;\n        padding: 0 4em;\n      }\n      .my-app .tab-views {\n        overflow: hidden;\n      }\n      .my-app .tabs {\n        border-bottom: 1px solid #999;\n        flex-wrap: wrap;\n        align-items: flex-end;\n      }\n      .my-app .tabs > li {\n        padding: 1px 5px 2px;\n        border: 1px solid #999;\n        border-bottom: none;\n        background: #EEE;\n        margin-right: -1px;\n        position: relative;\n        bottom: -1px;\n      }\n      .my-app .tabs > li:hover {\n        background: #DEF;\n      }\n      .my-app .tabs > li.current {\n        padding-bottom: 4px;\n        background: #FFF;\n      }\n      .my-app .tabs > li > * {\n        vertical-align: middle;\n      }\n      .my-app .tabs > li.modified > .label::before {\n        content: '*'\n      }\n      .my-app .tabs > li .close-button {\n        border: 1px solid transparent;\n        font-size: 12px;\n        padding: 1px;\n        margin-left: 4px;\n      }\n      .my-app .tabs > li .close-button:hover {\n        border: 1px solid #CCC;\n      }\n      .my-app .views {\n        background: #EEE;\n      }\n      .my-app .views > li {\n        width: 0;\n        height: 0;\n        min-width: 100%;\n        min-height: 100%;\n        display: none;\n        position: relative;\n        z-index: 0;\n        overflow: auto;\n      }\n      .my-app .views > li.current {\n        display: inline-block;\n      }\n\n      .my-app .CodeMirror {\n        font-family: Consolas, Inconsolata, Monospace;\n        font-size: 14px;\n        height: 100%;\n        line-height: 18px;\n      }\n      .my-app .CodeMirror-code > :not(:last-child) .CodeMirror-line::after {\n        font-family: Monospace;\n        position: absolute;\n        content: \"↓\";\n        color: #999;\n        font-size: 9px;\n      }\n      .my-app .CodeMirror-code > :last-child .CodeMirror-line::after {\n        position: absolute;\n        content: \"[EOF]\";\n        color: #999;\n      }\n      .my-app .cm-tab::before {\n        font-family: Monospace;\n        position: absolute;\n        content: '>';\n        color: #999;\n        font-size: 9px;\n      }\n      .cm-ideographic-space::before {\n        font-family: Monospace;\n        position: absolute;\n        content: '□';\n        color: #CCC;\n      }\n      .CodeMirror-hints {\n        font-size: 14px;\n      }\n    "),this.uses(Y,j,N),'\n      <div class="my-app fullscreen flex column"\n        ondragover="return this.handleDragOver(event)"\n        ondrop="return this.handleDrop(event)"\n        onkeydown="return this.handleKeyDown(event)"\n        tabindex="-1"\n      >\n        \x3c!-- メニュー --\x3e\n        <ul id="menubar" class="menubar flex row"\n          onmousedown="return this.handleMenuMouseDown(event)"\n          onmouseup="return this.handleMenuMouseUp(event)"\n          oncontextmenu="event.preventDefault()"\n        >\n          <li data-key="workspace">ワークスペース▾</li>\n          <li data-key="newProject">新規</li>\n          <li data-key="loadProject">開く</li>\n          <li data-key="saveProject">保存</li>\n          <li data-key="run" class="flex row">\n            <i class="material-icons m-icon" style="color: #0A3;">\n              play_circle_outline\n            </i>\n            実行 (F5)\n          </li>\n        </ul>\n\n        <div class="flex row fit">\n          <t-ul id="sideArea" class="flex column side-area" style="width: 160px;"\n            oncontextmenu="return this.handleFileTreeContextMenu(event)"\n          >\n            <t-li id="sideAreaEmpty" class="flex column fit side-area-empty current">\n              <p>\n                ファイルツリーが空です。<br />\n                このエリアで右クリックメニューを開くか、ウィンドウ外からファイルをドロップしてファイルを追加してください。\n                \x3c!--<br /><a>ここをクリックして「index.html」を追加することもできます。</a>--\x3e\n              </p>\n            </t-li>\n            <t-li id="fileTreeArea" class="flex column fit">\n              \x3c!-- ファイルリスト --\x3e\n              <file-tree id="fileTree" class="file-tree"\n                ondblclick="return this.handleFileTreeDoubleClick(event)"\n                onmousedown="return this.handleFileTreeMouseDown(event)"\n                onkeydown="return this.handleFileTreeKeyDown(event)"\n              />\n            </t-li>\n          </t-ul>\n\n          \x3c!-- ファイルリスト可変幅 --\x3e\n          <div class="splitter" onmousedown="return this.handleSplitter(event)"></div>\n\n          <t-ul id="mainArea" class="flex column fit main-area">\n            <t-li id="mainAreaEmpty" class="flex column fit main-area-empty current">\n              <p>左のツリーからファイルを選択し、Enterキー、ダブルクリック、またはこのエリアへドラッグ&ドロップしてファイルを開いてください。</p>\n            </t-li>\n            \x3c!-- タブとエディタ --\x3e\n            <t-li id="tabViews" class="flex column fit tab-views">\n              <t-ul id="tabs" class="tabs flex row"\n                onchange="return this.handleTabChange(event)"\n                onmousedown="return this.handleTabMouseDown(event)"\n              ></t-ul>\n              <t-ul id="views" class="views flex fit row"></t-ul>\n            </t-li>\n          </t-ul>\n        </div>\n      </div>\n    '}constructor(e={},t=[]){super(),this.name=document.title,this.version="0.1.0",this.namespace=location.pathname.slice(1,location.pathname.lastIndexOf("/")),this.base=location.protocol+"//"+location.host+"/"+this.namespace+"/",this.idbFile=new V(this.namespace),this.debugWindow=null,this.projectSetting=null,window.navigator.serviceWorker.register("./sw.js"),window.addEventListener("beforeunload",this.handleClose.bind(this))}handleClose(e){this.debugWindow&&!this.debugWindow.closed&&this.debugWindow.close()}async init(){this.projectSetting=await this.idbFile.getWorkSpaceSetting(),await this.updateFileTree()}async main(){this.idbFile.firstTime?(await this.idbFile.initWorkSpaces(),await this.addFile({path:"index.html",file:new Blob(['<!DOCTYPE html>\n<html lang="ja">\n  <head>\n    <meta charset="UTF-8" />\n    <title>My App</title>\n  </head>\n  <body>\n    <p>Hello, World!</p>\n  </body>\n</html>'],{type:"text/html"})}),await this.openTab("index.html")):await this.restoreTabs()}async updateFileTree(){const{folders:e,files:t}=await this.idbFile.getAllFoldersAndFiles();this.fileTree.update(e,t),0===e.length&&0===t.length?this.sideArea.current=this.sideAreaEmpty:this.sideArea.current=this.fileTreeArea}async addFile(...e){await this.idbFile.addFiles(e),this.fileTree.addFile(e),this.sideArea.current=this.fileTreeArea}async deleteCurrentFileOrFolder(){const e=this.fileTree.getPath(),t=await this.idbFile.removeFile(e);for(const e of t){const t=this.tabs.get(e);t&&await this.closeTabs([t])}this.fileTree.remove(e),0===this.fileTree.childElementCount&&(this.sideArea.current=this.sideAreaEmpty)}async openTab(e,t=!0){if(!_(this.tabs).find((t=>t.path===e))){const t=await this.idbFile.getFile(e),n=new N({value:e}),i=new ne({view:n,path:e,file:t});if("image/"===t.type.slice(0,6)){const e=document.createElement("img");e.src=URL.createObjectURL(t),n.element.appendChild(e)}else await this.createEditor(i),i.editor.focus();this.tabs.element.appendChild(i.element),this.views.element.appendChild(n.element)}t&&(this.tabs.value=e,this.mainArea.current=this.tabViews,await this.saveTabs())}async saveTabs(){this.projectSetting.tabs=[..._(this.tabs).map((e=>e.path))],this.projectSetting.currentTab=this.tabs.current?.path,await this.idbFile.putWorkSpaceSetting(this.projectSetting)}async restoreTabs(){for(const e of this.projectSetting.tabs)await this.openTab(e,!1);this.projectSetting.currentTab&&await this.openTab(this.projectSetting.currentTab)}async createEditor(e){const[t,n]=await Promise.all([Promise.all([s.e(191),s.e(1)]).then(s.bind(s,9800)),e.file.text()]),i=t.default,r=document.createElement("textarea");r.value=n,e.view.element.appendChild(r);const a=i.fromTextArea(r,{lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0,mode:{name:e.file.type,globalVars:!0},gutters:["CodeMirror-lint-markers"],lint:{esversion:11,asi:!0}});a.addOverlay({flattenSpans:!1,token(e,t){if(e.match("　"))return"ideographic-space";for(;null!=e.next()&&!e.match("　",!1););return null}}),a.on("keydown",((e,t)=>{if(13===t.keyCode&&""===e.getSelection()){const n=e.getCursor(),i=e.getLine(n.line);i.length-i.trimLeft().length>=n.ch?(t.preventDefault(),e.replaceRange("\n",{line:n.line,ch:0})):i.trimRight().length<=n.ch&&e.replaceRange(i.trimRight(),{line:n.line,ch:0},n)}})),a.on("change",((e,t)=>{this.tabs.current.isModified=!0})),e.editor=a}async closeTabs(e,t=!0){let n=this.tabs.current?.element;for(const t of[...e])t===this.tabs.current&&(n=t.element.previousElementSibling||t.element.nextElementSibling),this.tabs.element.removeChild(t.element),this.views.element.removeChild(t.view.element);this.tabs.value=n?T.from(n).value:null,0===this.tabs.length&&(this.mainArea.current=this.mainAreaEmpty),t&&await this.saveTabs()}async saveTab(...e){for(const t of e){if(!t.isModified)continue;const e=t.file,n=new Blob([t.editor.getValue()],{type:e.type}),i=t.path;await this.idbFile.putFile(i,n),t.isModified=!1}}handleDragOver(e){e.preventDefault()}handleDrop(e){return e.preventDefault(),this.addFile(..._(e.dataTransfer.files).map((e=>({path:e.name,file:new Blob([e],{type:e.type})}))))}handleKeyDown(e){switch(e.keyCode){case 83:if(e.ctrlKey)return e.preventDefault(),this.saveTab(this.tabs.current);break;case 116:return e.preventDefault(),this.run()}}handleFileTreeKeyDown(e){switch(e.keyCode){case 13:return this.command("open");case 46:return this.command("delete");case 113:return this.command("rename")}}handleFileTreeDoubleClick(e){if(!e.target.classList.contains("expand-icon")&&this.fileTree.current&&!this.fileTree.current.isExpandable)return this.openTab(this.fileTree.getPath())}async handleFileTreeContextMenu(e){e.preventDefault();const t=await te(e);t&&await this.command(t)}async command(e){switch(e){case"newFile":case"newFolder":{let t=this.fileTree.current;t&&(t.isExpandable||(t=t.parentNode),t!==this.fileTree&&t.expand());const n="newFile"===e?"ファイル":"フォルダー";let i="";for(;;){if(i=await this.inputFileName(`${n}名`,i,`新規${n}`),!i)return;const t=this.idbFile.getFileType(i),r=this.fileTree.getFolderPath()+i,s="newFile"===e?{path:r,file:new Blob([""],{type:t})}:{path:r};try{return void await this.addFile(s)}catch(e){if("ConstraintError"!==e.name)throw e;await M("この場所には同名のファイルまたはフォルダーがあります","エラー")}}}case"rename":{const e=this.fileTree.current.text,t=this.fileTree.current.isExpandable,n=await this.inputFileName(t?"フォルダー名":"ファイル名",e,"名前の変更");if(!n)return;let i=this.fileTree.getPath(this.fileTree.current.parentNode);return""!==i&&(i+="/"),this.fileListMove(i+e,i+n)}case"delete":{const e=this.fileTree.current.isExpandable;if(!await A((e?"フォルダー":"ファイル")+' "'+this.fileTree.current.text+'" を削除しますか?'))break;return this.deleteCurrentFileOrFolder()}case"open":if(!this.fileTree.current||this.fileTree.current.isExpandable)return;return this.openTab(this.fileTree.getPath());default:throw new Error("Undefiend command: "+e)}}async inputFileName(e,t,n){for(;;){const i=await D(e+"を入力してください",t,n);if(!i)return"";let r="";if(_('\\/:*?"<>|').some((e=>i.includes(e)))?r=e+'には次の文字は使えません:\n\\ / : * ? " < > |':"."!==i&&".."!==i||(r="その"+e+"を付けることはできません"),!r)return i;await M(r,"注意"),t=i}}async fileListMove(e,t){if(e===t)return;if((t+"/").startsWith(e+"/"))return void await M("受け側のフォルダーは、送り側フォルダーのサブフォルダーです。","中断");if(await this.idbFile.getFile(t))return void await M("受け側のフォルダーに同名のファイルまたはフォルダーがあります。","中断");const n=await this.idbFile.moveFile(e,t);for(const[e,t]of n){const n=_(this.tabs).find((t=>t.path===e));n&&(n.path=t),await this.saveTabs()}this.fileTree.move(e,t)}async handleFileTreeMouseDown(e){if(1===e.button)return;const t=_(function*(e){for(;e;)yield e,e=e.parentNode}(e.target)).map((e=>T.from(e))).find((e=>e instanceof K.Item));if(!t)return;let n=null;const i=[];let r=null;S({ondragstart:(e,r,s)=>{n=T.createElement('\n          <div style="position: absolute; text-align: center; opacity: .75;" class="flex column"></div>\n        '),n.appendChild(t.element.querySelector(".icon").cloneNode(!0)),n.appendChild(t.element.querySelector("span").cloneNode(!0)),s.appendChild(n),function e(t){for(const n of t){const t=n.element.firstElementChild;i.push({item:n,elem:t,rect:t.getBoundingClientRect()}),n.isExpandable&&n.isExpanded&&e(n)}}(this.fileTree),i.push({item:this.fileTree,elem:this.fileTree.element,rect:this.fileTree.element.getBoundingClientRect()}),i.push({item:null,elem:this.mainArea.element,rect:this.mainArea.element.getBoundingClientRect()}),this.fileTree.element.blur()},ondrag:(e,t)=>{n.style.top=t-n.clientWidth/2+"px",n.style.left=e-n.clientHeight/2+"px";const s=i.find((({item:n,rect:i})=>e>=i.left&&e<i.left+i.width&&t>=i.top&&t<i.top+i.height));r&&r.elem.classList.remove("drop-target"),r=s,s&&s.elem.classList.add("drop-target")},ondragend:(e,n)=>{if(r){if(r.elem.classList.remove("drop-target"),r.elem===this.mainArea.element){if(!this.fileTree.current||this.fileTree.current.isExpandable)return;return this.openTab(this.fileTree.getPath())}if(this.fileTree.focus(),r.item===t)return;const e=this.fileTree.getPath(t),n=this.fileTree.getFolderPath(r.item)+t.text;return this.fileListMove(e,n)}},onerror:e=>{this.onerror(e)}})}async handleTabChange(e){const t=this.tabs.current;if(t){if(this.views.value=t.path,document.title=t.path+" - "+this.name,!t.editor)return;requestAnimationFrame((()=>{t.editor.refresh(),t.editor.focus()}))}await this.saveTabs()}async handleTabMouseDown(e){if(0!==e.button)return;if(e.target.classList.contains("close-button"))return e.preventDefault(),void await this.closeTabs([T.from(e.target.parentElement)]);let t,n,i;const r=()=>{t=null,requestAnimationFrame((()=>{t=[..._(this.tabs).map(((e,t)=>({idx:t,element:e.element,rect:e.element.getBoundingClientRect()})))],n=_(this.tabs).indexOf(this.tabs.current)}))};r(),S({ondrag:(e,s)=>{if(!t)return;const a=t.find((t=>e>=t.rect.left&&e<t.rect.right&&s>=t.rect.top&&s<t.rect.bottom));null!=a&&a.element!==this.tabs.current.element?i!==a.element&&(i=a.element,this.tabs.element.insertBefore(this.tabs.current.element,a.idx<n?a.element:a.element.nextElementSibling),r()):i=null},ondragend:()=>{this.saveTabs()},onerror:e=>{this.onerror(e)}})}handleSplitter(e){const t=e.target.previousElementSibling,n=e.pageX-t.style.width.slice(0,-2);S({cursor:window.getComputedStyle(e.target).cursor,ondrag:e=>{t.style.width=Math.max(0,e-n)+"px",this.tabs.current&&this.tabs.current.editor.refresh()},onerror:e=>{this.onerror(e)}})}handleMenuMouseDown(e){const t=ee(this.menubar,e.target);if(t)return"workspace"===t.dataset.key?this.showWorkSpaceList(e):void 0}async handleMenuMouseUp(e){const t=ee(this.menubar,e.target);if(!t)return;const n=t.dataset.key;if(null!=n)switch(n){case"workspace":return;case"newProject":if(!await A("現在のプロジェクトを閉じますか?\n(保存していないデータは失われます)"))return;return this.newProject();case"loadProject":if(!await A("現在のプロジェクトを閉じて、別のプロジェクトを開きますか?\n(保存していないデータは失われます)"))return;return this.loadProject();case"saveProject":return this.saveProject();case"run":return this.run(e);default:throw new Error("Undefiend command: "+n)}}async showWorkSpaceList(e){if(e.target.classList.contains("selected"))return;e.target.classList.add("selected");const t=await this.idbFile.getAllWorkSpaces(),n=await $(`\n      ${t.map(((e,t)=>`<div data-value="${t}"><i class="material-icons" style="font-size: 16px;">${e.path+"/"===this.idbFile.workspace?"check":"_"}</i><span>${e.label}</span></div>`)).join("")}\n    `)(e.target),i=t[n];e.target.classList.remove("selected"),i&&this.idbFile.workspace!==i.path+"/"&&(await this.closeTabs(this.tabs,!1),this.projectSetting=i.setting,this.idbFile.workspace=i.path+"/",await this.updateFileTree(),await this.restoreTabs())}async run(){await Promise.all(_(this.tabs).map((e=>this.saveTab(e)))),_(this.fileTree).every((e=>"index.html"!==e.text))?await M('"index.html" が無いため実行できません'):this.debugWindow&&!this.debugWindow.closed?(await this.debugWindow.fetch(this.base+"resources/blank.txt"),this.debugWindow.location.replace(this.base+"debug/"+this.idbFile.workspace)):(this.debugWindow=window.open(this.base+"resources/blank.txt","appWindow","width=400,height=400"),this.debugWindow.opener=null,this.debugWindow.onload=async function(){this.debugWindow.location.replace(this.base+"debug/"+this.idbFile.workspace)}.bind(this))}async saveProject(){const e=new Q(this.projectSetting);await e.save(async function(){return this.idbFile.getAllFiles()}.bind(this))&&await this.idbFile.putWorkSpaceSetting(this.projectSetting)}async newProject(e=!0){await this.closeTabs(this.tabs,!1),this.idbFile.removeAllFiles(),this.fileTree.textContent="",this.sideArea.current=this.sideAreaEmpty,e&&(this.projectSetting.fileName="",this.projectSetting.password="",await this.idbFile.putWorkSpaceSetting(this.projectSetting))}async loadProject(){const e=new Q(this.projectSetting),t=await e.load();t&&(await this.newProject(!1),await this.addFile(...t),await this.idbFile.putWorkSpaceSetting(this.projectSetting))}onerror(e){throw M(e.message,"エラー"),e}}),a=s.O(a)})();